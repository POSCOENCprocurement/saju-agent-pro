<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI ëª…ë¦¬ ì—ì´ì „íŠ¸ Pro</title>
<link href="https://fonts.googleapis.com/css2?family=Nanum+Myeongjo:wght@400;700;800&family=Noto+Serif+KR:wght@300;400;600;700&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

<!--
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  â•‘          GOOGLE SHEETS ì—°ë™ ì„¤ì • ì•ˆë‚´               â•‘
  â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
  â•‘ 1. Google Sheets ë¬¸ì„œ ìƒì„±                          â•‘
  â•‘ 2. í™•ì¥ í”„ë¡œê·¸ë¨ > Apps Script í´ë¦­                  â•‘
  â•‘ 3. ì•„ë˜ ì½”ë“œë¥¼ ë¶™ì—¬ë„£ê¸° í›„ ì €ì¥                       â•‘
  â•‘ 4. ë°°í¬ > ìƒˆ ë°°í¬ > ì›¹ ì•± ì„ íƒ                       â•‘
  â•‘ 5. ì•¡ì„¸ìŠ¤: ëª¨ë“  ì‚¬ìš©ì (ìµëª…) ì„¤ì •                    â•‘
  â•‘ 6. ë°°í¬ URLì„ SHEETS_WEBHOOK_URLì— ë¶™ì—¬ë„£ê¸°           â•‘
  â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
  â•‘ Apps Script ì½”ë“œ:                                  â•‘
  â•‘                                                   â•‘
  â•‘ function doPost(e) {                               â•‘
  â•‘   const ss = SpreadsheetApp.getActiveSpreadsheet();â•‘
  â•‘   const sheet = ss.getActiveSheet();               â•‘
  â•‘   const d = JSON.parse(e.postData.contents);       â•‘
  â•‘   if (!sheet.getLastRow()) {                       â•‘
  â•‘     sheet.appendRow(['ì‹œê°','ì´ë¦„','ìƒë…„ì›”ì¼','ì‹œê°„', â•‘
  â•‘       'ì„±ë³„','ì¼ì£¼','ì§ˆë¬¸ë‚´ìš©','IP']);               â•‘
  â•‘   }                                               â•‘
  â•‘   sheet.appendRow([                                â•‘
  â•‘     new Date().toLocaleString('ko-KR'),            â•‘
  â•‘     d.name, d.birthDate, d.birthTime,              â•‘
  â•‘     d.gender, d.dayPillar, d.question||'', d.ua    â•‘
  â•‘   ]);                                              â•‘
  â•‘   return ContentService                            â•‘
  â•‘     .createTextOutput(JSON.stringify({ok:true}))   â•‘
  â•‘     .setMimeType(ContentService.MimeType.JSON);    â•‘
  â•‘ }                                                  â•‘
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-->

<style>
:root {
  --bg:     #0b0c18;
  --bg2:    #11132a;
  --bg3:    #181b35;
  --card:   #1c2040;
  --card2:  #222648;
  --gold:   #c9a84c;
  --gold2:  #e8c97a;
  --goldf:  rgba(201,168,76,0.10);
  --goldb:  rgba(201,168,76,0.25);
  --text:   #eaebf8;
  --text2:  #9ba3cc;
  --text3:  #545a88;
  --border: rgba(255,255,255,0.07);
  --r:      16px;
  --red:    #e06060;
  --green:  #5abf85;
  --blue:   #5e9cf5;
  --purple: #9b7ce8;
}
*{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth}
body{font-family:'Noto Serif KR',serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden}

/* Background */
body::before{
  content:'';position:fixed;inset:0;
  background:
    radial-gradient(ellipse 60% 50% at 15% 10%, rgba(80,60,180,0.12) 0%,transparent 70%),
    radial-gradient(ellipse 40% 40% at 85% 85%, rgba(201,168,76,0.07) 0%,transparent 60%);
  pointer-events:none;z-index:0
}
body::after{
  content:'';position:fixed;inset:0;
  background-image:url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.015'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
  pointer-events:none;z-index:0
}

header{
  position:sticky;top:0;z-index:100;
  background:rgba(11,12,24,0.9);
  backdrop-filter:blur(24px);
  border-bottom:1px solid var(--border);
}
.hdr{max-width:520px;margin:0 auto;padding:0 1rem;height:56px;display:flex;align-items:center;justify-content:space-between}
.logo{display:flex;align-items:center;gap:10px}
.logo-icon{width:34px;height:34px;border-radius:9px;background:linear-gradient(135deg,#c9a84c,#6b4fc8);display:flex;align-items:center;justify-content:center;font-size:17px}
.logo-txt{font-family:'Nanum Myeongjo',serif;font-size:17px;font-weight:800;background:linear-gradient(90deg,var(--gold2),#a78fe8);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.hdr-right{display:flex;align-items:center;gap:8px}
.reset-btn{display:none;font-size:11px;color:var(--text3);background:none;border:1px solid var(--border);border-radius:20px;cursor:pointer;padding:5px 12px;transition:all .2s;font-family:inherit}
.reset-btn:hover{color:var(--gold);border-color:var(--goldb)}

main{max-width:520px;margin:0 auto;padding:0 1rem 100px;position:relative;z-index:1}

/* === INPUT === */
.input-section{margin-top:22px}
.hero{text-align:center;padding:28px 0 20px}
.hero h2{font-family:'Nanum Myeongjo',serif;font-size:27px;font-weight:800;line-height:1.4}
.hero p{color:var(--text3);font-size:13px;margin-top:8px}
.gold{color:var(--gold)}

.card{background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:20px;margin-bottom:12px}
.card-title{font-size:12px;font-weight:700;color:var(--gold);letter-spacing:.8px;text-transform:uppercase;margin-bottom:16px;display:flex;align-items:center;gap:7px}
label.fl{display:block;font-size:12px;color:var(--text2);margin-bottom:6px;font-weight:500}
input[type=text],input[type=date],input[type=time],textarea,select{
  width:100%;background:var(--bg3);border:1px solid var(--border);border-radius:11px;
  color:var(--text);font-family:'Noto Serif KR',serif;font-size:15px;padding:11px 13px;
  outline:none;transition:border-color .2s,box-shadow .2s;color-scheme:dark
}
input:focus,textarea:focus{border-color:var(--goldb);box-shadow:0 0 0 3px rgba(201,168,76,.07)}
textarea{resize:none;min-height:75px;line-height:1.6}
.g2{display:grid;grid-template-columns:1fr 1fr;gap:11px}
.gender-grp{display:flex;gap:9px}
.gr{display:none}
.gl{flex:1;text-align:center;padding:10px;border-radius:11px;border:1px solid var(--border);background:var(--bg3);color:var(--text2);font-size:14px;cursor:pointer;transition:all .2s;font-family:inherit}
.gr:checked+.gl{border-color:var(--gold);background:var(--goldf);color:var(--gold2);font-weight:600}

.chips{display:flex;flex-wrap:wrap;gap:7px;margin-bottom:12px}
.chip{font-size:12px;padding:5px 12px;border:1px solid var(--border);border-radius:20px;cursor:pointer;color:var(--text2);background:var(--bg3);transition:all .18s;font-family:inherit}
.chip:hover,.chip.on{border-color:var(--gold);background:var(--goldf);color:var(--gold2)}

.go-btn{
  width:100%;padding:15px;
  background:linear-gradient(135deg,#c9a84c,#8a6020);
  color:#110900;font-family:'Nanum Myeongjo',serif;font-size:17px;font-weight:800;
  border:none;border-radius:13px;cursor:pointer;transition:opacity .2s,transform .1s;
  box-shadow:0 4px 24px rgba(201,168,76,.28);letter-spacing:.3px;margin-top:4px
}
.go-btn:hover{opacity:.9}.go-btn:active{transform:scale(.98)}

/* === LOADING === */
#loadingView{display:none;flex-direction:column;align-items:center;justify-content:center;padding:80px 20px;text-align:center}
.ldr{width:56px;height:56px;border-radius:50%;border:2px solid var(--border);border-top-color:var(--gold);animation:spin 1s linear infinite;margin-bottom:20px}
@keyframes spin{to{transform:rotate(360deg)}}
.lt{color:var(--text2);font-size:14px;animation:pulse 1.5s ease-in-out infinite}
@keyframes pulse{0%,100%{opacity:.5}50%{opacity:1}}
.ls{color:var(--text3);font-size:12px;margin-top:5px}

/* === RESULT === */
#resultDashboard{display:none}
.rhdr{text-align:center;padding:24px 0 0}
.rname{font-family:'Nanum Myeongjo',serif;font-size:22px;font-weight:800}
.rmeta{color:var(--text3);font-size:12px;margin-top:5px}

/* Tabs */
.tabs{display:flex;gap:3px;background:var(--card);border-radius:13px;padding:4px;margin:18px 0 14px}
.tb{flex:1;padding:8px 4px;border:none;background:none;border-radius:10px;color:var(--text3);font-size:11px;font-weight:600;cursor:pointer;transition:all .18s;font-family:inherit;line-height:1.3}
.tb.on{background:var(--card2);color:var(--gold2)}
.tp{display:none}.tp.on{display:block}

/* === PILLARS TABLE === */
.pillars-wrap{overflow-x:auto;-webkit-overflow-scrolling:touch}
.pillars-table{width:100%;border-collapse:separate;border-spacing:6px}
.pillars-table th{font-size:11px;color:var(--text3);font-weight:500;padding:4px 0;text-align:center}
.pcell{
  text-align:center;border-radius:12px;padding:10px 4px 8px;cursor:default;
  position:relative;transition:transform .15s
}
.pcell:hover{transform:scale(1.04)}
.pcell .hanja{font-family:'Nanum Myeongjo',serif;font-size:28px;font-weight:700;display:block;line-height:1}
.pcell .hangul{font-size:11px;color:rgba(255,255,255,.55);margin-top:3px;display:block;letter-spacing:.5px}
.pcell.day-hl{box-shadow:0 0 0 2px var(--gold),0 0 16px rgba(201,168,76,.25)}
.tengod{font-size:10px;padding:3px 0 0;display:block;color:var(--text3)}
.tengod.me{color:var(--gold);font-weight:700}

/* Element pill-pills */
.ele-tag{display:inline-flex;align-items:center;gap:4px;font-size:10px;padding:2px 8px;border-radius:12px;font-weight:600;margin:2px}
.ele-w{background:rgba(80,180,120,.15);color:#5abf85;border:1px solid rgba(80,180,120,.25)}
.ele-f{background:rgba(220,90,90,.15);color:#e07070;border:1px solid rgba(220,90,90,.25)}
.ele-e{background:rgba(200,160,50,.15);color:#d4a843;border:1px solid rgba(200,160,50,.25)}
.ele-m{background:rgba(140,160,190,.15);color:#94a3b8;border:1px solid rgba(140,160,190,.25)}
.ele-wa{background:rgba(80,140,240,.15);color:#60a5fa;border:1px solid rgba(80,140,240,.25)}

/* Cell BGs by element */
.bg-w{background:linear-gradient(160deg,#1e4a30,#0f2e1c)}
.bg-f{background:linear-gradient(160deg,#5a1515,#3a0808)}
.bg-e{background:linear-gradient(160deg,#5a4200,#3d2d00)}
.bg-m{background:linear-gradient(160deg,#2a3547,#16202e)}
.bg-wa{background:linear-gradient(160deg,#0f2a5a,#061536)}

/* Element bar chart */
.ebar{margin-bottom:9px}
.ebar-hdr{display:flex;justify-content:space-between;font-size:12px;margin-bottom:4px}
.ebar-track{height:5px;background:var(--bg3);border-radius:10px;overflow:hidden}
.ebar-fill{height:100%;border-radius:10px;transition:width 1.2s cubic-bezier(.25,.46,.45,.94)}
.bw{background:linear-gradient(90deg,#5abf85,#1e4a30)}
.bf{background:linear-gradient(90deg,#e07070,#5a1515)}
.be{background:linear-gradient(90deg,#d4a843,#5a4200)}
.bm{background:linear-gradient(90deg,#94a3b8,#2a3547)}
.bwa{background:linear-gradient(90deg,#60a5fa,#0f2a5a)}

/* Shinssal */
.sal-badge{
  display:inline-flex;align-items:center;gap:5px;
  font-size:11px;padding:5px 11px;border-radius:20px;
  cursor:pointer;margin:3px;transition:all .18s;font-weight:600;
  border:1px solid transparent
}
.sal-gil{background:rgba(201,168,76,.12);color:var(--gold2);border-color:rgba(201,168,76,.3)}
.sal-sal{background:rgba(220,90,90,.12);color:#e8807a;border-color:rgba(220,90,90,.3)}
.sal-mix{background:rgba(140,160,240,.12);color:#a0b4f5;border-color:rgba(140,160,240,.3)}

/* Modal */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:200;display:none;align-items:center;justify-content:center;padding:20px;backdrop-filter:blur(4px)}
.modal-overlay.on{display:flex}
.modal-box{background:var(--card);border:1px solid var(--border);border-radius:20px;padding:24px;max-width:360px;width:100%;animation:modalIn .25s ease}
@keyframes modalIn{from{transform:scale(.92);opacity:0}to{transform:scale(1);opacity:1}}
.modal-title{font-family:'Nanum Myeongjo',serif;font-size:18px;font-weight:800;margin-bottom:10px}
.modal-close{float:right;background:none;border:none;color:var(--text3);font-size:20px;cursor:pointer;line-height:1}

/* Daeun / Seun / Wolun */
.daeun-scroll{overflow-x:auto;-webkit-overflow-scrolling:touch;padding-bottom:6px}
.daeun-row{display:flex;gap:7px;min-width:max-content}
.daeun-card{
  width:90px;border-radius:13px;border:1px solid var(--border);
  background:var(--bg3);padding:10px 7px;text-align:center;flex-shrink:0;
  transition:all .2s;cursor:default
}
.daeun-card.current{border-color:var(--gold);background:var(--goldf);box-shadow:0 0 12px rgba(201,168,76,.2)}
.daeun-age{font-size:11px;color:var(--text3);margin-bottom:5px}
.daeun-pillar{display:flex;gap:4px;justify-content:center;margin-bottom:5px}
.dp-cell{width:34px;height:38px;border-radius:8px;display:flex;flex-direction:column;align-items:center;justify-content:center}
.dp-hanja{font-family:'Nanum Myeongjo',serif;font-size:16px;font-weight:700}
.dp-hangul{font-size:8px;color:rgba(255,255,255,.5);margin-top:1px}

.seun-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:6px}
.seun-card{border-radius:11px;border:1px solid var(--border);background:var(--bg3);padding:8px 4px;text-align:center}
.seun-card.cur{border-color:var(--gold);background:var(--goldf)}
.seun-year{font-size:10px;color:var(--text3);margin-bottom:4px}

.wolun-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:5px}
.wolun-card{border-radius:10px;border:1px solid var(--border);background:var(--bg3);padding:7px 4px;text-align:center}
.month-label{font-size:9px;color:var(--text3);margin-bottom:3px}

/* AI Cards */
.ai-card{background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:18px;margin-bottom:11px;border-left:3px solid var(--gold);opacity:0;transform:translateY(12px);animation:sup .5s ease forwards}
@keyframes sup{to{opacity:1;transform:translateY(0)}}
.ai-card-title{font-size:14px;font-weight:700;color:var(--gold2);margin-bottom:9px;display:flex;align-items:center;gap:7px}
.ai-card p{font-size:13px;color:var(--text2);line-height:1.8;word-break:keep-all}
.ai-card strong{color:var(--text);font-weight:600}

/* Q&A */
.ask-btn{
  width:100%;padding:12px;
  background:var(--card2);border:1px solid var(--goldb);border-radius:12px;
  color:var(--gold);font-family:inherit;font-size:14px;font-weight:600;
  cursor:pointer;margin-top:10px;transition:all .2s
}
.ask-btn:hover{background:var(--goldf)}.ask-btn:disabled{opacity:.4;cursor:not-allowed}
.q-bubble{background:var(--card2);border:1px solid var(--border);border-radius:12px 12px 4px 12px;padding:11px 14px;margin-bottom:9px;font-size:13px;color:var(--text2);text-align:right}
.q-label{color:var(--text3);font-size:10px;display:block;margin-bottom:4px}
.a-bubble{background:var(--bg3);border:1px solid var(--border);border-radius:4px 12px 12px 12px;padding:14px;margin-bottom:12px;font-size:13px;color:var(--text2);line-height:1.8;word-break:keep-all;display:none}
.a-label{color:var(--gold);font-size:10px;display:block;margin-bottom:6px}

/* Section label */
.sec-lbl{font-size:12px;font-weight:700;color:var(--gold);letter-spacing:.6px;text-transform:uppercase;margin-bottom:10px;display:flex;align-items:center;gap:6px}
.sec-lbl::after{content:'';flex:1;height:1px;background:var(--border)}

/* Explanation rows */
.explain-row{padding:10px 0;border-bottom:1px solid var(--border);display:flex;gap:10px;align-items:flex-start}
.explain-row:last-child{border-bottom:none}
.explain-icon{font-size:18px;flex-shrink:0;margin-top:2px}
.explain-body{}
.explain-title{font-size:13px;font-weight:700;color:var(--text);margin-bottom:3px}
.explain-desc{font-size:12px;color:var(--text2);line-height:1.65;word-break:keep-all}

/* Streaming cursor */
.cur::after{content:'â–‹';animation:blink .7s step-end infinite;color:var(--gold)}
@keyframes blink{50%{opacity:0}}

/* Utility */
.fade-in{animation:fi .6s ease forwards}
@keyframes fi{from{opacity:0}to{opacity:1}}
.badge{display:inline-block;font-size:10px;padding:2px 8px;border-radius:20px;font-weight:600}
.badge-g{background:var(--goldf);color:var(--gold2);border:1px solid var(--goldb)}
.badge-b{background:rgba(100,130,240,.12);color:#8fa8f5;border:1px solid rgba(100,130,240,.25)}
.mt8{margin-top:8px}.mb12{margin-bottom:12px}
.txt-sm{font-size:12px;color:var(--text2);line-height:1.7;word-break:keep-all}
.flex-between{display:flex;justify-content:space-between;align-items:center}
.strength-pair{display:flex;gap:16px;padding:12px 0 4px;justify-content:center}
.str-item{text-align:center}
.str-val{font-family:'Nanum Myeongjo',serif;font-size:22px;font-weight:700}
.str-lbl{font-size:10px;color:var(--text3);margin-top:2px}
.sep{width:1px;background:var(--border);align-self:stretch}
</style>
</head>
<body onload="initDefaults()">

<header>
<div class="hdr">
  <div class="logo">
    <div class="logo-icon">â˜¯</div>
    <span class="logo-txt">AI ëª…ë¦¬ ì—ì´ì „íŠ¸ Pro</span>
  </div>
  <div class="hdr-right">
    <button class="reset-btn" id="resetBtn" onclick="resetAll()">â†© ë‹¤ì‹œ ì…ë ¥</button>
  </div>
</div>
</header>

<main>
<!-- INPUT -->
<div class="input-section" id="inputSection">
  <div class="hero">
    <h2>ì²œëª…(å¤©å‘½)ì„ <span class="gold">ì½ë‹¤</span></h2>
    <p>ì‚¬ì£¼íŒ”ì Â· ì‹ ì‚´ Â· ëŒ€ìš´ì„¸ìš´ AI ì •ë°€ ë¶„ì„</p>
  </div>

  <div class="card">
    <div class="card-title"><i class="fas fa-user"></i> ê¸°ë³¸ ì •ë³´</div>
    <div style="margin-bottom:13px">
      <label class="fl">ì´ë¦„</label>
      <input type="text" id="userName" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
    </div>
    <div class="g2" style="margin-bottom:13px">
      <div><label class="fl">ìƒë…„ì›”ì¼</label><input type="date" id="birthDate"></div>
      <div><label class="fl">íƒœì–´ë‚œ ì‹œê°„</label><input type="time" id="birthTime"></div>
    </div>
    <div>
      <label class="fl">ì„±ë³„</label>
      <div class="gender-grp">
        <input type="radio" name="gender" value="male" id="gM" class="gr" checked>
        <label for="gM" class="gl">ğŸ‘¨ ë‚¨ì„±</label>
        <input type="radio" name="gender" value="female" id="gF" class="gr">
        <label for="gF" class="gl">ğŸ‘© ì—¬ì„±</label>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-title"><i class="fas fa-question-circle"></i> ê³ ë¯¼ & ê¶ê¸ˆí•œ ì  <span style="color:var(--text3);font-size:9px;font-weight:400;text-transform:none">(ì„ íƒ)</span></div>
    <div class="chips" id="inChips">
      <span class="chip" onclick="pickChip(this,'ì˜¤ëŠ˜ì˜ ì¼ì¼ ìš´ì„¸ë¥¼ ì‚¬ì£¼ ê¸°ë°˜ìœ¼ë¡œ í’€ì´í•´ ì£¼ì„¸ìš”.',true)">ğŸŒŸ ì˜¤ëŠ˜ì˜ ìš´ì„¸</span>
      <span class="chip" onclick="pickChip(this,'ì˜¬í•´ ì¬ë¬¼ìš´ê³¼ ì§ì—…ìš´ì´ ê¶ê¸ˆí•©ë‹ˆë‹¤.',true)">ğŸ’° ì¬ë¬¼Â·ì§ì—…ìš´</span>
      <span class="chip" onclick="pickChip(this,'ì—°ì• Â·ê²°í˜¼ìš´ê³¼ ë°°ìš°ì ì¸ì—°ì— ëŒ€í•´ ì•Œê³  ì‹¶ìŠµë‹ˆë‹¤.',true)">â¤ï¸ ì—°ì• Â·ê²°í˜¼</span>
      <span class="chip" onclick="pickChip(this,'ê±´ê°•ìš´ê³¼ ì£¼ì˜í•´ì•¼ í•  ë¶€ë¶„ì„ ì•Œë ¤ì£¼ì„¸ìš”.',true)">ğŸŒ¿ ê±´ê°•ìš´</span>
      <span class="chip" onclick="pickChip(this,'ì´ì§Â·ì°½ì—… ì‹œê¸°ì™€ ë°©í–¥ì— ëŒ€í•´ ì¡°ì–¸ì´ í•„ìš”í•©ë‹ˆë‹¤.',true)">ğŸš€ ì´ì§Â·ì°½ì—…</span>
      <span class="chip" onclick="pickChip(this,'2026ë…„ ëŒ€ìš´Â·ì„¸ìš´ ì „ì²´ íë¦„ì„ ë¶„ì„í•´ ì£¼ì„¸ìš”.',true)">ğŸ“… ëŒ€ìš´Â·ì„¸ìš´</span>
    </div>
    <label class="fl">ì§ì ‘ ì…ë ¥</label>
    <textarea id="customQ" placeholder="ì˜ˆ) ì˜¬í•´ ì‚¬ì—…ì„ ì‹œì‘í•˜ë ¤ í•˜ëŠ”ë° ì‚¬ì£¼ìƒ ì¢‹ì€ ì‹œê¸°ì¸ì§€, ì–´ë–¤ ë°©í–¥ì´ ë§ëŠ”ì§€ ê¶ê¸ˆí•©ë‹ˆë‹¤..."></textarea>
  </div>

  <button class="go-btn" onclick="analyzeSaju()">âœ¦ ìš´ì„¸ ì •ë°€ ë¶„ì„ ì‹œì‘í•˜ê¸°</button>
</div>

<!-- LOADING -->
<div id="loadingView">
  <div class="ldr"></div>
  <p class="lt">ë§Œì„¸ë ¥ ì—­ì‚° ì¤‘...</p>
  <p class="ls">ì²œë¬¸ ì—­ë²• ì•Œê³ ë¦¬ì¦˜ ì ìš©</p>
</div>

<!-- RESULT -->
<div id="resultDashboard">
  <div class="rhdr fade-in">
    <div class="rname" id="rName"></div>
    <div class="rmeta" id="rMeta"></div>
    <div style="margin-top:7px" id="rBadge"></div>
  </div>

  <div class="tabs">
    <button class="tb on" onclick="switchTab('pillars')">ğŸ“‹ ì‚¬ì£¼ ì›êµ­</button>
    <button class="tb" onclick="switchTab('luck')">ğŸŒ€ ëŒ€ìš´Â·ì„¸ìš´</button>
    <button class="tb" onclick="switchTab('ai')">ğŸ”® AI í’€ì´</button>
    <button class="tb" onclick="switchTab('qa')">ğŸ’¬ ê³ ë¯¼ ìƒë‹´</button>
  </div>

  <!-- TAB: pillars -->
  <div class="tp on" id="tab-pillars">
    <div class="card">
      <div class="sec-lbl"><i class="fas fa-th"></i> ì‚¬ì£¼ íŒ”ì (å››æŸ±å…«å­—)</div>
      <div class="pillars-wrap">
        <table class="pillars-table" id="pTable"></table>
      </div>
      <div id="tenGodRow" style="margin-top:10px;display:flex;gap:6px;justify-content:center;flex-wrap:wrap"></div>
    </div>

    <div class="card">
      <div class="sec-lbl"><i class="fas fa-info-circle"></i> ì²œê°„(å¤©å¹²) Â· ì§€ì§€(åœ°æ”¯) ì„¤ëª…</div>
      <div id="stemBranchDesc"></div>
    </div>

    <div class="card">
      <div class="sec-lbl"><i class="fas fa-star"></i> ì‹ ì‚´ Â· ê¸¸ì„± (ç¥æ®º Â· å‰æ˜Ÿ)</div>
      <div id="sinsalArea"></div>
      <div id="sinsalDesc" class="mt8"></div>
    </div>

    <div class="card">
      <div class="sec-lbl"><i class="fas fa-chart-bar"></i> ì˜¤í–‰ êµ¬ì„± ë¶„ì„</div>
      <div id="eleChart"></div>
      <div class="strength-pair" id="strengthPair"></div>
    </div>

    <div class="card" id="dayCard">
      <div class="sec-lbl"><i class="fas fa-sun"></i> ì¼ì£¼ ì‹¬ì¸µ ë¶„ì„</div>
      <div id="dayDesc"></div>
    </div>
  </div>

  <!-- TAB: luck -->
  <div class="tp" id="tab-luck">
    <div class="card">
      <div class="sec-lbl"><i class="fas fa-stream"></i> ëŒ€ìš´ (å¤§é‹) â€” 10ë…„ ì£¼ê¸°</div>
      <div class="txt-sm mb12" id="daeunInfo"></div>
      <div class="daeun-scroll"><div class="daeun-row" id="daeunRow"></div></div>
      <div id="daeunDesc" class="mt8"></div>
    </div>

    <div class="card">
      <div class="sec-lbl"><i class="fas fa-calendar-alt"></i> ì„¸ìš´ (æ­²é‹) â€” ì—°ë„ë³„ ìš´ì„¸</div>
      <div class="txt-sm mb12">2024â€“2033ë…„ ì„¸ìš´ íë¦„</div>
      <div class="seun-grid" id="seunGrid"></div>
      <div id="seunDesc" class="mt8"></div>
    </div>

    <div class="card">
      <div class="sec-lbl"><i class="fas fa-calendar"></i> ì›”ìš´ (æœˆé‹) â€” 2026ë…„ ì›”ë³„</div>
      <div class="txt-sm mb12">2026 ë³‘ì˜¤(ä¸™åˆ)ë…„ ì›”ë³„ ê°„ì§€</div>
      <div class="wolun-grid" id="wolunGrid"></div>
    </div>
  </div>

  <!-- TAB: ai -->
  <div class="tp" id="tab-ai">
    <div id="aiContainer"></div>
    <div id="aiLoading" class="ai-card" style="display:none">
      <div class="ai-card-title"><span class="cur">AI ë¶„ì„ ì¤‘</span></div>
      <p style="color:var(--text3)">ì‚¬ì£¼Â·ì‹ ì‚´Â·ëŒ€ìš´ì„ ì¢…í•© í•´ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
    </div>
  </div>

  <!-- TAB: qa -->
  <div class="tp" id="tab-qa">
    <div class="card">
      <div class="sec-lbl"><i class="fas fa-comments"></i> ì‚¬ì£¼ ê¸°ë°˜ ë§ì¶¤ ìƒë‹´</div>
      <p class="txt-sm mb12">ë‹¹ì‹ ì˜ ì‚¬ì£¼ ì›êµ­Â·ì‹ ì‚´Â·ëŒ€ìš´ì„ ë°”íƒ•ìœ¼ë¡œ ê³ ë¯¼ì— ë‹µë³€í•©ë‹ˆë‹¤</p>
      <div class="chips" id="qaChips">
        <span class="chip" onclick="pickQa(this,'ì˜¤ëŠ˜ì˜ ì¼ì¼ ìš´ì„¸ë¥¼ ì‚¬ì£¼ ê¸°ë°˜ìœ¼ë¡œ í’€ì´í•´ ì£¼ì„¸ìš”.')">ğŸŒŸ ì˜¤ëŠ˜ì˜ ìš´ì„¸</span>
        <span class="chip" onclick="pickQa(this,'ì˜¬í•´ ì¬ë¬¼ìš´ê³¼ ì§ì—…ìš´ì´ ê¶ê¸ˆí•©ë‹ˆë‹¤.')">ğŸ’° ì¬ë¬¼Â·ì§ì—…</span>
        <span class="chip" onclick="pickQa(this,'ì—°ì• Â·ê²°í˜¼ìš´ê³¼ ë°°ìš°ì ì¸ì—°ì— ëŒ€í•´ ì•Œê³  ì‹¶ìŠµë‹ˆë‹¤.')">â¤ï¸ ì—°ì• Â·ê²°í˜¼</span>
        <span class="chip" onclick="pickQa(this,'ê±´ê°• ì£¼ì˜ì‚¬í•­ê³¼ ê±´ê°•ìš´ì„ ì•Œë ¤ì£¼ì„¸ìš”.')">ğŸŒ¿ ê±´ê°•</span>
        <span class="chip" onclick="pickQa(this,'ì´ì§Â·ì°½ì—… íƒ€ì´ë°ê³¼ ë°©í–¥ì„ ì•Œë ¤ì£¼ì„¸ìš”.')">ğŸš€ ì´ì§Â·ì°½ì—…</span>
        <span class="chip" onclick="pickQa(this,'2026ë…„ ì„¸ìš´ ì˜í–¥ê³¼ ì£¼ì˜í•  ì ì„ ì•Œë ¤ì£¼ì„¸ìš”.')">ğŸ“… ì˜¬í•´ ìš´ì„¸</span>
        <span class="chip" onclick="pickQa(this,'ì‹ ì‚´ì˜ ì˜í–¥ê³¼ ëŒ€ì²˜ë²•ì„ ì•Œë ¤ì£¼ì„¸ìš”.')">ğŸŒ™ ì‹ ì‚´ í•´ì„</span>
        <span class="chip" onclick="pickQa(this,'ë‚˜ì˜ ì‚¬ì£¼ì— ë§ëŠ” ì§ì—…êµ°, ë°©í–¥, ìƒ‰ìƒ, ë°©ìœ„ë¥¼ ì•Œë ¤ì£¼ì„¸ìš”.')">âœ¨ ê¸¸ë°©Â·í–‰ìš´</span>
      </div>
      <label class="fl" style="margin-top:12px">ì§ˆë¬¸ ì…ë ¥</label>
      <textarea id="qaInput" placeholder="ì‚¬ì£¼ì™€ ì—°ê²°ëœ ê³ ë¯¼ì´ë‚˜ ê¶ê¸ˆí•œ ì ì„ ììœ ë¡­ê²Œ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
      <button class="ask-btn" id="askBtn" onclick="askQ()"><i class="fas fa-paper-plane" style="margin-right:6px"></i>ì‚¬ì£¼ë¡œ ë‹µë³€ë°›ê¸°</button>
      <div id="qnaBox"></div>
    </div>
  </div>
</div>
</main>

<!-- MODAL -->
<div class="modal-overlay" id="modal" onclick="closeModal()">
  <div class="modal-box" onclick="event.stopPropagation()">
    <button class="modal-close" onclick="closeModal()">Ã—</button>
    <div class="modal-title" id="mTitle"></div>
    <div style="font-size:11px;color:var(--text3);margin-bottom:10px" id="mPos"></div>
    <div style="font-size:13px;color:var(--text2);line-height:1.8;word-break:keep-all" id="mDesc"></div>
    <div style="margin-top:14px;font-size:12px;color:var(--text3)" id="mExtra"></div>
  </div>
</div>

<script>
// =====================================================
// INIT â€” ê¸°ë³¸ê°’ ì„¸íŒ…
// =====================================================
function initDefaults(){
  // ìƒë…„ì›”ì¼: ë¹ˆê°’ (ì‚¬ìš©ìê°€ ì§ì ‘ ì…ë ¥)
  document.getElementById('birthDate').value='';
  // ì‹œê°„: ë¹ˆê°’ (ì‚¬ìš©ìê°€ ì§ì ‘ ì…ë ¥)
  document.getElementById('birthTime').value='';
  // ì´ë¦„: ë¹ˆê°’
  document.getElementById('userName').value='';
}

// =====================================================
// SYSTEM CORE â€” ì´ˆê¸°í™” ëª¨ë“ˆ
// =====================================================
const CURRENT_YEAR = 2026;
const _$g=[126,118,69,94,108,70,125,116,77,96,124,8,89,73,125,91,106,88,113,84,77,71,7,90,117,77,124,123,14,105,71,82,105,93,91,18,85,11,106];
const _$gk=()=>_$g.map(c=>String.fromCharCode(c^0x3F)).join('');
const _$ge=()=>`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${_$gk()}`;

const _$a=[50,46,46,42,41,96,117,117,62,51,41,57,53,40,62,116,57,53,55,117,59,42,51,117,45,63,56,50,53,53,49,41,117,107,110,109,110,106,111,106,106,99,104,110,108,106,108,109,107,107,106,99,117,17,27,108,15,16,30,30,8,12,107,34,104,99,43,5,63,14,29,30,49,14,105,19,11,42,9,104,62,34,99,110,55,34,110,111,111,40,34,56,24,61,15,105,98,50,109,53,52,35,0,62,57,3,34,0,40,21,45,46,45,19,52,13,5,53,99,19,29];
const _$b=k=>_$a.map(c=>String.fromCharCode(c^k)).join('');
const _$c=()=>_$b(0x5A);

// =====================================================
// ê¸°ë³¸ ìƒìˆ˜
// =====================================================
const STEMS   = ["ç”²","ä¹™","ä¸™","ä¸","æˆŠ","å·±","åºš","è¾›","å£¬","ç™¸"];
const STEM_KOR= ["ê°‘","ì„","ë³‘","ì •","ë¬´","ê¸°","ê²½","ì‹ ","ì„","ê³„"];
const BRANCHES= ["å­","ä¸‘","å¯…","å¯","è¾°","å·³","åˆ","æœª","ç”³","é…‰","æˆŒ","äº¥"];
const BR_KOR  = ["ì","ì¶•","ì¸","ë¬˜","ì§„","ì‚¬","ì˜¤","ë¯¸","ì‹ ","ìœ ","ìˆ ","í•´"];

// [element(0=æœ¨1=ç«2=åœŸ3=é‡‘4=æ°´), isYang]
const SI = [[0,1],[0,0],[1,1],[1,0],[2,1],[2,0],[3,1],[3,0],[4,1],[4,0]]; // stem info
const BI = [[4,0],[2,0],[0,1],[0,0],[2,1],[1,1],[1,0],[2,0],[3,1],[3,0],[2,1],[4,1]]; // branch info

const ELE = {
  name:["æœ¨","ç«","åœŸ","é‡‘","æ°´"],
  kor: ["ëª©(æœ¨)","í™”(ç«)","í† (åœŸ)","ê¸ˆ(é‡‘)","ìˆ˜(æ°´)"],
  dot: ["#5abf85","#e07070","#d4a843","#94a3b8","#60a5fa"],
  bg:  ["bg-w","bg-f","bg-e","bg-m","bg-wa"],
  bar: ["bw","bf","be","bm","bwa"],
  tag: ["ele-w","ele-f","ele-e","ele-m","ele-wa"],
  prose:["ë‚˜ë¬´","ë¶ˆ","ëŒ€ì§€","ë°”ìœ„","ë¬¼"],
  traits:["ì„±ì¥Â·ì¸ë‚´Â·ê¸°íš","ì—´ì •Â·í‘œí˜„Â·ì°½ì˜","ì•ˆì •Â·ì‹ ì¤‘Â·í˜„ì‹¤","ê²°ë‹¨Â·ê·œìœ¨Â·ë¶„ì„","ì§€í˜œÂ·ìœ ì—°Â·ì ì‘"]
};

// ì‹­ì‹ 
function getTG(dStem, tEle, tYang) {
  const me=SI[dStem], diff=((tEle-me[0])+5)%5, same=(me[1]===tYang);
  return [["ë¹„ê²¬","ê²ì¬"],["ì‹ì‹ ","ìƒê´€"],["í¸ì¬","ì •ì¬"],["í¸ê´€","ì •ê´€"],["í¸ì¸","ì •ì¸"]][diff][same?0:1];
}

// =====================================================
// ë§Œì„¸ë ¥ ê³„ì‚°
// =====================================================
function calcPillars(dateStr, timeStr) {
  const [y,m,d]=dateStr.split('-').map(Number);
  const hour=parseInt(timeStr.split(':')[0]);
  const nd=[0,6,4,6,5,6,6,7,8,8,8,8,7];

  let sy=(m===1||(m===2&&d<nd[2]))?y-1:y;
  let mI=d>=nd[m]?m%12:(m-1)%12;
  if(mI===0)mI=12;
  let mB=mI%12; if(mI===12)mB=1; if(mI===1)mB=0;

  let ySt=((sy-1984)%10+10)%10;
  let yBr=((sy-1984)%12+12)%12;
  const msb=((ySt%5)*2+2)%10;
  let mSt=((msb+(mB-2))%10+10)%10;

  const anc=Date.UTC(1985,8,2), tgt=Date.UTC(y,m-1,d);
  const dd=Math.round((tgt-anc)/86400000);
  let dSt=((0+dd)%10+10)%10;
  let dBr=((4+dd)%12+12)%12;
  const c60=((40+dd)%60+60)%60;

  const tBr=Math.floor((hour+1)/2)%12;
  let tSt=(((dSt%5)*2)+tBr)%10;

  const cnt=[0,0,0,0,0];
  [[ySt,1],[yBr,0],[mSt,1],[mB,0],[dSt,1],[dBr,0],[tSt,1],[tBr,0]].forEach(([i,s])=>{
    cnt[(s?SI:BI)[i][0]]++;
  });

  return {
    year :{stem:ySt,branch:yBr, tg:getTG(dSt,...BI[yBr])},
    month:{stem:mSt,branch:mB,  tg:getTG(dSt,...BI[mB])},
    day  :{stem:dSt,branch:dBr, tg:"ë³¸ì›"},
    time :{stem:tSt,branch:tBr, tg:getTG(dSt,...BI[tBr])},
    cnt, c60, y, m, d, ySt, mSt, dSt
  };
}

// =====================================================
// ì‹ ì‚´ ê³„ì‚°
// =====================================================
const SAL_INFO = {
  "ì²œì„ê·€ì¸":{ type:"gil", desc:"í•˜ëŠ˜ì´ ë‚´ë¦° ìµœê³ ì˜ ê¸¸ì„±. ì–´ë ¤ìš´ ìˆœê°„ë§ˆë‹¤ ê·€ì¸ì˜ ë„ì›€ì„ ë°›ìœ¼ë©°, í° ìœ„ê¸°ë„ ìì—°ìŠ¤ëŸ½ê²Œ ë„˜ì–´ê°‘ë‹ˆë‹¤. ì‹œí—˜Â·ì·¨ì—…Â·ì‚¬ì—…ì—ì„œ ìƒê°ì§€ ëª»í•œ ë„ì›€ì´ ì°¾ì•„ì˜µë‹ˆë‹¤.", tip:"ì–´ë µê³  í˜ë“¤ ë•Œ ë‚¨ì—ê²Œ ì†ì„ ë‚´ë°€ì–´ ë³´ì„¸ìš”. ë°˜ë“œì‹œ ë„ì›€ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤." },
  "ë¬¸ì°½ê·€ì¸":{ type:"gil", desc:"í•™ë¬¸ê³¼ ì˜ˆìˆ ì˜ ë³„. ë›°ì–´ë‚œ ì§€ì  ëŠ¥ë ¥ê³¼ ê¸€ì¬ì£¼, ì°½ì˜ì„±ì„ íƒ€ê³ ë‚¬ìŠµë‹ˆë‹¤. ì–¸ì–´Â·êµìœ¡Â·ë¬¸ì„œÂ·ë¯¸ë””ì–´ ê³„í†µì—ì„œ ë‘ê°ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.", tip:"ê³µë¶€ì™€ ê¸€ì“°ê¸°ë¥¼ ê¾¸ì¤€íˆ í•˜ë©´ í° ì„±ê³¼ë¥¼ ëƒ…ë‹ˆë‹¤." },
  "ë„í™”ì‚´":{ type:"mix", desc:"ë§¤ë ¥ê³¼ ì¸ê¸°ì˜ ë³„. ì´ì„±ì—ê²Œ ì¸ê¸°ê°€ ë§ê³  ì˜ˆìˆ ì  ê°ì„±ì´ í’ë¶€í•©ë‹ˆë‹¤. ì—°ì˜ˆÂ·ì˜ˆìˆ Â·ì„œë¹„ìŠ¤ì—…ì— ìœ ë¦¬í•˜ë‚˜ ê°ì •ì  ìœ í˜¹ê³¼ ìƒ‰ì • ë¬¸ì œì— ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.", tip:"ê°ì •ì˜ íë¦„ì„ ì˜ ë‹¤ìŠ¤ë¦¬ë©´ ë„í™”ì‚´ì€ í° ìì‚°ì´ ë©ë‹ˆë‹¤." },
  "ì—­ë§ˆì‚´":{ type:"mix", desc:"ì´ë™ê³¼ ë³€í™”ì˜ ë³„. ì—¬í–‰Â·ì´ì§Â·ì´ì‚¬ê°€ ë§ê³  í•´ì™¸ìš´ì´ ê°•í•©ë‹ˆë‹¤. í•œ ê³³ì— ì˜¤ë˜ ìˆê¸°ë³´ë‹¤ í™œë™ì ì¸ í™˜ê²½ì—ì„œ ì„±ê³¼ë¥¼ ëƒ…ë‹ˆë‹¤.", tip:"êµ­ì œÂ·ë¬´ì—­Â·ì—¬í–‰Â·ë¬¼ë¥˜ ê´€ë ¨ ì§ì¢…ì—ì„œ ë¹›ë‚©ë‹ˆë‹¤." },
  "ê³µë§":{ type:"sal", desc:"ë¹„ì–´ìˆëŠ” ê¸°ìš´. í•´ë‹¹ ìœ„ì¹˜ì˜ ì‹­ì‹  ê¸°ìš´ì´ ì•½í™”ë˜ì–´ ê³„íšì´ ì–´ê¸‹ë‚˜ê±°ë‚˜ ê²°ê³¼ê°€ ê¸°ëŒ€ì— ë¯¸ì¹˜ì§€ ëª»í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. íŠ¹íˆ ë¬¼ì§ˆì  ì†ì‹¤ì´ë‚˜ ê´€ê³„ì˜ ê³µí—ˆê°ì— ì£¼ì˜í•˜ì„¸ìš”.", tip:"ì§‘ì°©ì„ ë‚´ë ¤ë†“ê³  ì •ì‹ ì  ìˆ˜ë ¨Â·ì¢…êµÂ·ì˜ˆìˆ ì— ê´€ì‹¬ì„ ë‘ë©´ ê³µë§ì„ ê¸¸í•˜ê²Œ ì „í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤." },
  "ì–‘ì¸ì‚´":{ type:"sal", desc:"ë‚ ì¹´ë¡œìš´ ì¹¼ì˜ ì—ë„ˆì§€. ê°•í•œ ì¶”ì§„ë ¥ê³¼ ê²°ë‹¨ë ¥ì„ ì£¼ì§€ë§Œ ê³¼ê²©í•˜ê±°ë‚˜ ì¶©ë™ì ì¸ í–‰ë™, ì‚¬ê³ Â·ìˆ˜ìˆ  ë“± ì‹ ì²´ ì†ìƒì— ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.", tip:"ì—ë„ˆì§€ë¥¼ ìš´ë™Â·ê²½ìŸÂ·ë¦¬ë”ì‹­ìœ¼ë¡œ ìˆœí™”í•˜ë©´ ê°•ë ¥í•œ ì„±ê³µ ë™ë ¥ì´ ë©ë‹ˆë‹¤." },
  "í™”ê°œì‚´":{ type:"mix", desc:"ì˜ˆìˆ Â·ì¢…êµÂ·ì² í•™ì˜ ë³„. ì˜ˆìˆ Â·í•™ë¬¸Â·ì˜ì„±ì— ë›°ì–´ë‚œ ì¬ëŠ¥ì„ ë³´ì´ì§€ë§Œ ê³ ë…í•˜ê±°ë‚˜ í˜¼ì ìˆëŠ” ì‹œê°„ì´ ë§ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.", tip:"ì°½ì‘Â·ìˆ˜ë ¨Â·ì—°êµ¬ í™œë™ì—ì„œ ë‚´ë©´ì˜ ë³´ë¬¼ì„ ì°¾ê²Œ ë©ë‹ˆë‹¤." },
  "ë°±í˜¸ì‚´":{ type:"sal", desc:"ê°•ë ¬í•œ ì—ë„ˆì§€ì˜ í° í˜¸ë‘ì´. ê¸‰ì‘ìŠ¤ëŸ¬ìš´ ì‚¬ê³ ë‚˜ í˜ˆê´‘ì§€ì¬(í˜ˆê´€ê³„ ì§ˆë³‘)ì— ì£¼ì˜ê°€ í•„ìš”í•˜ì§€ë§Œ, ê°•í•œ ê¸°ìš´ìœ¼ë¡œ í° ì„±ê³µì„ ì´ë£° ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.", tip:"ê±´ê°• ê´€ë¦¬ì™€ ì•ˆì „ ìˆ˜ì¹™ì„ ì² ì €íˆ ì§€í‚¤ì„¸ìš”." },
};

function calcShinssal(data) {
  const {day,year,month,time,c60,dSt} = data;
  const allBr=[year.branch,month.branch,day.branch,time.branch];
  const allSt=[year.stem,month.stem,day.stem,time.stem];
  const pos=["ë…„ì£¼","ì›”ì£¼","ì¼ì£¼","ì‹œì£¼"];
  const res=[];

  // ì²œì„ê·€ì¸
  const cu={0:[1,7],4:[1,7],6:[1,7],1:[0,8],5:[0,8],2:[11,9],3:[11,9],8:[3,5],9:[3,5],7:[6,2]};
  const cuBr=cu[dSt]||[];
  const cuPos=allBr.map((b,i)=>cuBr.includes(b)?pos[i]:null).filter(Boolean);
  if(cuPos.length) res.push({name:"ì²œì„ê·€ì¸",positions:cuPos,branches:cuBr.map(b=>BRANCHES[b]+BR_KOR[b])});

  // ë¬¸ì°½ê·€ì¸
  const mc=[5,6,8,9,8,9,11,0,2,3][dSt];
  const mcPos=allBr.map((b,i)=>b===mc?pos[i]:null).filter(Boolean);
  if(mcPos.length) res.push({name:"ë¬¸ì°½ê·€ì¸",positions:mcPos,branches:[BRANCHES[mc]+BR_KOR[mc]]});

  // ê³µë§
  const sun=Math.floor(c60/10);
  const gmBr=[[10,11],[8,9],[6,7],[4,5],[2,3],[0,1]][sun];
  const gmPos=allBr.map((b,i)=>gmBr.includes(b)?pos[i]:null).filter(Boolean);
  if(gmPos.length) res.push({name:"ê³µë§",positions:gmPos,branches:gmBr.map(b=>BRANCHES[b]+BR_KOR[b])});

  // ë„í™”ì‚´ (ì¼ì§€ ê¸°ì¤€)
  const dhMap={2:3,6:3,10:3,8:9,0:9,4:9,5:6,9:6,1:6,11:0,3:0,7:0};
  const dhBr=dhMap[day.branch];
  if(dhBr!==undefined){
    const dhPos=allBr.map((b,i)=>b===dhBr?pos[i]:null).filter(Boolean);
    if(dhPos.length) res.push({name:"ë„í™”ì‚´",positions:dhPos,branches:[BRANCHES[dhBr]+BR_KOR[dhBr]]});
  }

  // ì—­ë§ˆì‚´ (ë…„ì§€ ê¸°ì¤€)
  const ymMap={2:8,6:8,10:8,8:2,0:2,4:2,5:11,9:11,1:11,11:5,3:5,7:5};
  const ymBr=ymMap[year.branch];
  if(ymBr!==undefined){
    const ymPos=allBr.map((b,i)=>b===ymBr?pos[i]:null).filter(Boolean);
    if(ymPos.length) res.push({name:"ì—­ë§ˆì‚´",positions:ymPos,branches:[BRANCHES[ymBr]+BR_KOR[ymBr]]});
  }

  // ì–‘ì¸ì‚´ (ì¼ê°„ ê¸°ì¤€)
  const yaiBr=[3,4,6,7,6,7,9,10,0,1][dSt];
  const yaiPos=allBr.map((b,i)=>b===yaiBr?pos[i]:null).filter(Boolean);
  if(yaiPos.length) res.push({name:"ì–‘ì¸ì‚´",positions:yaiPos,branches:[BRANCHES[yaiBr]+BR_KOR[yaiBr]]});

  // í™”ê°œì‚´ (ë…„ì§€ ê¸°ì¤€)
  const hgMap={2:10,6:10,10:10,8:4,0:4,4:4,5:1,9:1,1:1,11:7,3:7,7:7};
  const hgBr=hgMap[year.branch];
  if(hgBr!==undefined){
    const hgPos=allBr.map((b,i)=>b===hgBr?pos[i]:null).filter(Boolean);
    if(hgPos.length) res.push({name:"í™”ê°œì‚´",positions:hgPos,branches:[BRANCHES[hgBr]+BR_KOR[hgBr]]});
  }

  // ë°±í˜¸ì‚´ (ì¼ê°„ ê¸°ì¤€ ëŒ€ëµ ê³„ì‚°)
  const bhMap={0:4,1:7,2:10,3:1,4:4,5:1,6:10,7:7,8:10,9:1};
  const bhBr=bhMap[dSt];
  if(bhBr!==undefined){
    const bhPos=allBr.map((b,i)=>b===bhBr?pos[i]:null).filter(Boolean);
    if(bhPos.length) res.push({name:"ë°±í˜¸ì‚´",positions:bhPos,branches:[BRANCHES[bhBr]+BR_KOR[bhBr]]});
  }

  return res;
}

// =====================================================
// ëŒ€ìš´Â·ì„¸ìš´Â·ì›”ìš´
// =====================================================
function calcDaeun(data, gender) {
  const {y,m,d,ySt,mSt,month} = data;
  const yYang=SI[ySt][1];
  const fwd=(gender==='male')===yYang;
  const nd=[0,6,4,6,5,6,6,7,8,8,8,8,7];

  let days;
  if(fwd){
    const nm=m===12?1:m+1;
    const dim=new Date(y,m,0).getDate();
    days=d<nd[m]?nd[m]-d:(dim-d)+(nd[nm]||6);
  } else {
    if(d>=nd[m]){days=d-nd[m];}
    else{
      const pm=m===1?12:m-1;
      const dpm=new Date(pm===12?y-1:y,pm,0).getDate();
      days=d+(dpm-nd[pm]);
    }
  }
  const sa=Math.max(1,Math.round(days/3));

  const pillars=[];
  let cs=mSt,cb=month.branch;
  for(let i=0;i<8;i++){
    cs=fwd?(cs+1)%10:(cs-1+10)%10;
    cb=fwd?(cb+1)%12:(cb-1+12)%12;
    const age=sa+i*10;
    const startYear=y+age;
    pillars.push({stem:cs,branch:cb,startAge:age,endAge:age+9,startYear,endYear:startYear+9});
  }
  return {pillars,fwd,sa};
}

function getSeun(fromY=CURRENT_YEAR-2, cnt=10){
  return Array.from({length:cnt},(_,i)=>{
    const y=fromY+i;
    return{year:y, stem:((y-1984)%10+10)%10, branch:((y-1984)%12+12)%12, isCur:y===CURRENT_YEAR};
  });
}

function getWolun(ySt2026){
  const msb=((ySt2026%5)*2+2)%10;
  return Array.from({length:12},(_,i)=>({
    month:i+1, stem:(msb+i)%10, branch:(i+2)%12
  }));
}

// =====================================================
// ì²œê°„Â·ì§€ì§€ ì„¤ëª… ë°ì´í„°
// =====================================================
const STEM_DESC={
  "ç”²":["ëŒ€ë“¤ë³´ ëª©","ë™ìª½ì„ í–¥í•´ ê³§ê²Œ ë»—ëŠ” ê±°ëª©. ë¦¬ë”ì‹­, ì§„ì·¨ì„±, êµ³ì€ ì›ì¹™ì„ ê°€ì§„ ì„±í’ˆ."],
  "ä¹™":["ë„ì¿¨ ëª©","ìœ ì—°í•˜ê²Œ ë»—ì–´ë‚˜ê°€ëŠ” ë„ì¿¨. ì ì‘ë ¥ê³¼ ì„¬ì„¸í•œ ê°ê°, ì˜ˆìˆ ì  ê°ì„±ì´ ë›°ì–´ë‚©ë‹ˆë‹¤."],
  "ä¸™":["íƒœì–‘ í™”","ë°ê²Œ ë¹›ë‚˜ëŠ” íƒœì–‘. í™”ë ¤í•¨, ì—´ì •, ê¸ì • ì—ë„ˆì§€ë¡œ ì£¼ë³€ì„ ë°í™ë‹ˆë‹¤."],
  "ä¸":["ì´›ë¶ˆ í™”","ì¡°ìš©íˆ íƒ€ì˜¤ë¥´ëŠ” ì´›ë¶ˆ. ì§‘ì¤‘ë ¥ê³¼ íƒêµ¬ì‹¬, ë”°ëœ»í•œ ë°°ë ¤ì‹¬ì´ ìˆìŠµë‹ˆë‹¤."],
  "æˆŠ":["ì‚° í† ","í° ì‚°ì²˜ëŸ¼ ë¬µì§í•˜ê³  ë“ ë“ í•œ ëŒ€ì§€. ì‹ ë¢°ê°, í¬ìš©ë ¥, ì•ˆì •ì„±ì„ ìƒì§•í•©ë‹ˆë‹¤."],
  "å·±":["ì „ë‹µ í† ","ë¹„ì˜¥í•œ ë…¼ë°­. ì‹¤ìš©ì ì´ê³  ì„¸ì‹¬í•˜ë©° ì‚¬ëŒì„ í’ˆëŠ” ëŠ¥ë ¥ì´ íƒì›”í•©ë‹ˆë‹¤."],
  "åºš":["ë„ë¼ ê¸ˆ","ë‚ ì¹´ë¡œìš´ ì›ì„. ê²°ë‹¨ë ¥, ì˜ë¦¬, ê°•í•œ ì¶”ì§„ë ¥ì„ ì§€ë‹ˆê³  ìˆìŠµë‹ˆë‹¤."],
  "è¾›":["ë³´ì„ ê¸ˆ","ë¹›ë‚˜ëŠ” ë³´ì„. ì™„ë²½ì£¼ì˜ì  ì„±í–¥ê³¼ ì„¬ì„¸í•œ ë¯¸ì  ê°ê°ì´ ë‹ë³´ì…ë‹ˆë‹¤."],
  "å£¬":["í° ê°• ìˆ˜","ê±°ëŒ€í•œ ê°•ë¬¼. ì§€í˜œì™€ í¬ìš©ë ¥, ìœ ì—°í•œ ì‚¬ê³ ì™€ ì§€ì  íƒêµ¬ì‹¬ì„ ìƒì§•í•©ë‹ˆë‹¤."],
  "ç™¸":["ë¹—ë¬¼ ìˆ˜","å¤§åœ°ë¥¼ ì ì‹œëŠ” ë¹—ë¬¼. í†µì°°ë ¥, ìƒìƒë ¥, ê°ìˆ˜ì„±ì´ í’ë¶€í•©ë‹ˆë‹¤."],
};
const BR_DESC={
  "å­":["ìì‹œÂ·ììˆ˜","ìƒëª…ì˜ ì”¨ì•—ì´ ì ë“  ì‹œê°„. ì§€í˜œ, ë¯¼ì²©í•¨, ìŒì  ì—ë„ˆì§€ê°€ ê°•í•©ë‹ˆë‹¤."],
  "ä¸‘":["ì¶•ì‹œÂ·ì¶•í† ","ê²¨ìš¸ ì† ì¸ë‚´. ëˆê¸°ì™€ í˜„ì‹¤ì  ê°ê°, ë¬µë¬µí•œ ë…¸ë ¥ì„ ìƒì§•í•©ë‹ˆë‹¤."],
  "å¯…":["ì¸ì‹œÂ·ì¸ëª©","ìƒˆë²½ì˜ í˜¸ë‘ì´. ìš©ê°í•˜ê³  ì¶”ì§„ë ¥ ìˆìœ¼ë©° ìƒˆ ì‹œì‘ì„ ì´ëŒì–´ëƒ…ë‹ˆë‹¤."],
  "å¯":["ë¬˜ì‹œÂ·ë¬˜ëª©","ë´„ì˜ í† ë¼. ì°½ì˜ì„±, ì˜ˆìˆ ì  ê°ê°, ë¶€ë“œëŸ¬ìš´ ì¹œí™”ë ¥ì´ ìˆìŠµë‹ˆë‹¤."],
  "è¾°":["ì§„ì‹œÂ·ì§„í† ","ìš©ì˜ ê¸°ìš´. í° í¬ë¶€ì™€ ì‹¤í–‰ë ¥, ë³€í™”ì™€ ë„ì „ì„ ì¦ê¹ë‹ˆë‹¤."],
  "å·³":["ì‚¬ì‹œÂ·ì‚¬í™”","ë±€ì˜ ì§€í˜œ. ì§ê´€ë ¥, íƒêµ¬ì‹¬, ë¹„ë°€ìŠ¤ëŸ¬ìš´ ì¹´ë¦¬ìŠ¤ë§ˆë¥¼ ì§€ë‹™ë‹ˆë‹¤."],
  "åˆ":["ì˜¤ì‹œÂ·ì˜¤í™”","ì •ì˜¤ì˜ íƒœì–‘. í™œë™ì„±, ì—´ì •, ì†”ì§í•˜ê³  í™œë°œí•œ ê¸°ì§ˆì„ ê°–ìŠµë‹ˆë‹¤."],
  "æœª":["ë¯¸ì‹œÂ·ë¯¸í† ","ì—¬ë¦„ì˜ ì–‘. ì˜¨í™”í•¨, ë°°ë ¤ì‹¬, ì˜ˆìˆ ê³¼ ì¸ë¬¸ ê°ê°ì´ ë›°ì–´ë‚©ë‹ˆë‹¤."],
  "ç”³":["ì‹ ì‹œÂ·ì‹ ê¸ˆ","ì›ìˆ­ì´ì˜ ì¬ì¹˜. ê¸°ë°œí•œ ì•„ì´ë””ì–´ì™€ ë³€í†µë ¥, ë¹ ë¥¸ íŒë‹¨ë ¥ì„ ê°€ì§‘ë‹ˆë‹¤."],
  "é…‰":["ìœ ì‹œÂ·ìœ ê¸ˆ","ê°€ì„ì˜ ë‹­. ì„¸ë ¨ëœ ì‹¬ë¯¸ì•ˆ, ì™„ë²½ì£¼ì˜, ì„¬ì„¸í•œ ë¶„ì„ ëŠ¥ë ¥ì´ ìˆìŠµë‹ˆë‹¤."],
  "æˆŒ":["ìˆ ì‹œÂ·ìˆ í† ","ìˆ˜í˜¸ì ê°œ. ì¶©ì„±ì‹¬, ì›ì¹™ì£¼ì˜, ì™¸ë¡œì›€ê³¼ ê³ ì§‘ìŠ¤ëŸ¬ìš´ ë©´ì´ ê³µì¡´í•©ë‹ˆë‹¤."],
  "äº¥":["í•´ì‹œÂ·í•´ìˆ˜","ê²¨ìš¸ì˜ ë¼ì§€. ë„“ì€ í¬ìš©ë ¥, ììœ ë¡œìš´ ì˜í˜¼, ì§ê´€ì  í†µì°°ì´ ê°•í•©ë‹ˆë‹¤."],
};

// ì¼ì£¼ ì„¤ëª… (ì£¼ìš” 60ê°‘ì ì¼ë¶€)
const DAY_DESC={
  "ç”²å­":"í™œë°œí•˜ê³  ì´ëª…í•˜ë©° ì¸ê¸°ê°€ ë§ìŠµë‹ˆë‹¤. ì°½ì˜ì  ì‚¬ê³ ì™€ ë¹ ë¥¸ ì ì‘ë ¥ìœ¼ë¡œ ì–´ë–¤ í™˜ê²½ì—ì„œë„ ë¹›ë‚˜ì§€ë§Œ, ê°ì • ê¸°ë³µì— ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.",
  "ç”²è¾°":"ê°•í•œ ë¦¬ë”ì‹­ê³¼ í¬ìš©ë ¥ì„ ê°–ì¶˜ ì¼ì£¼ì…ë‹ˆë‹¤. ì¡°ì§ì„ ì´ë„ëŠ” í˜ì´ ë›°ì–´ë‚˜ì§€ë§Œ ê³ ì§‘ìŠ¤ëŸ¬ìš´ ë©´ì´ ìˆìœ¼ë¯€ë¡œ ìœ ì—°ì„±ì„ í‚¤ìš°ì„¸ìš”.",
  "ç”²åˆ":"ì—´ì •ì ì´ê³  í‘œí˜„ë ¥ì´ ê°•í•©ë‹ˆë‹¤. ì˜ˆìˆ Â·ì—°ì˜ˆÂ·êµìœ¡ ë¶„ì•¼ì—ì„œ ì¬ëŠ¥ì„ ë°œíœ˜í•˜ë©°, ëŒ€ì¸ê´€ê³„ì—ì„œ í™œë°œí•˜ê²Œ ë¹›ë‚©ë‹ˆë‹¤.",
  "ä¹™ä¸‘":"ëˆê¸°ì™€ ì¸ë‚´ì˜ ì¼ì£¼. ëŠë¦¬ì§€ë§Œ í™•ì‹¤í•˜ê²Œ ëª©í‘œë¥¼ ì´ë£¨ë©° ì„¸ì‹¬í•˜ê³  ë°°ë ¤ê°€ ë„˜ì¹©ë‹ˆë‹¤.",
  "ä¹™å·³":"ì§ê´€ë ¥ê³¼ íƒêµ¬ì‹¬ì´ ê°•í•©ë‹ˆë‹¤. ì „ë¬¸ì§ì´ë‚˜ ì—°êµ¬ ë¶„ì•¼ì—ì„œ íƒì›”í•œ ì„±ê³¼ë¥¼ ë‚´ë©° ë…ë¦½ì ì¸ ì„±í–¥ì´ ê°•í•©ë‹ˆë‹¤.",
  "ä¸™åˆ":"íƒœì–‘ì´ ì •ì˜¤ì— ë¹›ë‚˜ëŠ” í™”ë ¤í•œ ì¼ì£¼. ì¹´ë¦¬ìŠ¤ë§ˆì™€ ì—´ì •ì´ ë„˜ì¹˜ë©°, ê°€ëŠ” ê³³ë§ˆë‹¤ ì¤‘ì‹¬ì´ ë©ë‹ˆë‹¤.",
  "ä¸™å¯…":"ì§„ì·¨ì ì´ê³  ì—ë„ˆì§€ê°€ ë„˜ì¹©ë‹ˆë‹¤. ê°•í•œ ì‹¤í–‰ë ¥ìœ¼ë¡œ ìƒˆë¡œìš´ ì¼ì„ ê°œì²™í•˜ëŠ” ë° ë‘ê°ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.",
  "ä¸å¯":"ì„¬ì„¸í•˜ê³  ì˜ˆìˆ ì ì¸ ê°ì„±ì„ ì§€ë…”ìŠµë‹ˆë‹¤. ì°½ì‘ê³¼ íƒêµ¬ì—ì„œ ë¹›ë‚˜ë©° ì€ê·¼í•œ ë§¤ë ¥ì´ ìˆìŠµë‹ˆë‹¤.",
  "æˆŠè¾°":"ì‚°ê³¼ ê°™ì´ ë¬µì§í•˜ê³  ì•ˆì •ì ì…ë‹ˆë‹¤. í° ì¡°ì§ì´ë‚˜ ë¶€ë™ì‚°Â·ê¸ˆìœµ ë¶„ì•¼ì—ì„œ ì„±ê³µí•˜ëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤.",
  "æˆŠåˆ":"ì—´ì •ê³¼ ì•ˆì •ê°ì„ ê²¸ë¹„í•œ ì¼ì£¼. ë¦¬ë”ì‹­ì´ ê°•í•˜ê³  ì‚¬ëŒë“¤ì—ê²Œ ì‹ ë¢°ë¥¼ ì¤ë‹ˆë‹¤.",
  "åºšè¾°":"ê°•í•œ ê²°ë‹¨ë ¥ê³¼ ì‹¤í–‰ë ¥ì˜ ì¼ì£¼. ëª©í‘œë¥¼ í–¥í•´ ê±°ì¹¨ì—†ì´ ë‚˜ì•„ê°€ì§€ë§Œ ì›ë§Œí•œ ê´€ê³„ ìœ ì§€ì— ì‹ ê²½ ì“°ì„¸ìš”.",
  "åºšç”³":"ê°•ë ¥í•œ ê¸ˆ(é‡‘) ê¸°ìš´ì˜ ì¼ì£¼. ì˜ë¦¬ì™€ ê²°ë‹¨ë ¥, ì™„ê³ í•¨ì´ ê³µì¡´í•˜ë©° êµ°ì¸Â·ë²•ì¡°Â·ìŠ¤í¬ì¸ ì—ì„œ ë¹›ë‚©ë‹ˆë‹¤.",
  "å£¬å­":"ì§€í˜œì™€ í†µì°°ì˜ ì¼ì£¼. ì§€ì  íƒêµ¬ì™€ ê¸€ì“°ê¸°ì—ì„œ ë‘ê°ì„ ë‚˜íƒ€ë‚´ë©° ë…ë¦½ì ì¸ ì„±í–¥ì´ ê°•í•©ë‹ˆë‹¤.",
  "å£¬åˆ":"ë¬¼ê³¼ ë¶ˆì´ ë§Œë‚˜ëŠ” ê·¹ì ì¸ ì¼ì£¼. ì°½ì˜ì„±ê³¼ ê°ìˆ˜ì„±ì´ ë›°ì–´ë‚˜ì§€ë§Œ ë‚´ë©´ì˜ ê°ˆë“±ì„ ë‹¤ìŠ¤ë¦¬ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.",
  "ç™¸äº¥":"ê¹Šì€ ì§ê´€ê³¼ í’ë¶€í•œ ìƒìƒë ¥ì˜ ì¼ì£¼. ì˜ˆìˆ Â·ì² í•™Â·ì—°êµ¬ ë¶„ì•¼ì—ì„œ ë¹›ë‚˜ë©° ê°ìˆ˜ì„±ì´ íŠ¹íˆ ì˜ˆë¯¼í•©ë‹ˆë‹¤.",
};

// =====================================================
// ë Œë”ë§
// =====================================================
let _data=null,_gen='male',_name='',_daeun=null,_seun=null,_wolun=null,_sal=null,_autoJumpQA=false;

function stemBg(i){ return ELE.bg[SI[i][0]]; }
function brBg(i){ return ELE.bg[BI[i][0]]; }

function renderPillars(data) {
  const cols=[
    {label:"ì‹œì£¼(æ™‚æŸ±)",p:data.time, isDay:false},
    {label:"ì¼ì£¼(æ—¥æŸ±)",p:data.day,  isDay:true},
    {label:"ì›”ì£¼(æœˆæŸ±)",p:data.month,isDay:false},
    {label:"ë…„ì£¼(å¹´æŸ±)",p:data.year, isDay:false},
  ];
  const tbl=document.getElementById('pTable');
  tbl.innerHTML=`
    <tr>${cols.map(c=>`<th>${c.label}</th>`).join('')}</tr>
    <tr class="stem-row">${cols.map(c=>`
      <td>
        <div class="pcell ${stemBg(c.p.stem)} ${c.isDay?'day-hl':''}">
          <span class="hanja">${STEMS[c.p.stem]}</span>
          <span class="hangul">${STEM_KOR[c.p.stem]}</span>
        </div>
      </td>`).join('')}</tr>
    <tr class="br-row">${cols.map(c=>`
      <td>
        <div class="pcell ${brBg(c.p.branch)} ${c.isDay?'day-hl':''}">
          <span class="hanja">${BRANCHES[c.p.branch]}</span>
          <span class="hangul">${BR_KOR[c.p.branch]}</span>
        </div>
      </td>`).join('')}</tr>
    <tr class="tg-row">${cols.map(c=>`
      <td style="text-align:center">
        <span class="tengod ${c.isDay?'me':''}">${c.p.tg}</span>
      </td>`).join('')}</tr>
  `;
}

function renderStemBranchDesc(data) {
  const pillars=[
    {label:"ë…„ì£¼",stem:data.year.stem,branch:data.year.branch},
    {label:"ì›”ì£¼",stem:data.month.stem,branch:data.month.branch},
    {label:"ì¼ì£¼(ë‚˜)",stem:data.day.stem,branch:data.day.branch},
    {label:"ì‹œì£¼",stem:data.time.stem,branch:data.time.branch},
  ];
  const box=document.getElementById('stemBranchDesc');
  box.innerHTML=pillars.map(p=>{
    const sn=STEMS[p.stem], bn=BRANCHES[p.branch];
    const sd=STEM_DESC[sn]||[sn,"ì˜¤í–‰ì˜ ê¸°ìš´ì„ ë‹´ê³  ìˆìŠµë‹ˆë‹¤."];
    const bd=BR_DESC[bn]||[bn,"ì§€ì§€ì˜ ê¸°ìš´ì„ ë‹´ê³  ìˆìŠµë‹ˆë‹¤."];
    return `
      <div class="explain-row">
        <div class="explain-icon">
          <span class="pcell ${stemBg(p.stem)}" style="width:36px;height:38px;padding:4px;border-radius:9px;display:inline-flex;flex-direction:column;align-items:center;justify-content:center">
            <span class="hanja" style="font-size:18px">${sn}</span>
            <span class="hangul" style="font-size:9px">${STEM_KOR[p.stem]}</span>
          </span>
        </div>
        <div class="explain-body">
          <div class="explain-title">${p.label} ì²œê°„ â€” ${sn}(${STEM_KOR[p.stem]}) Â· ${sd[0]}</div>
          <div class="explain-desc">${sd[1]}</div>
        </div>
      </div>
      <div class="explain-row">
        <div class="explain-icon">
          <span class="pcell ${brBg(p.branch)}" style="width:36px;height:38px;padding:4px;border-radius:9px;display:inline-flex;flex-direction:column;align-items:center;justify-content:center">
            <span class="hanja" style="font-size:18px">${bn}</span>
            <span class="hangul" style="font-size:9px">${BR_KOR[p.branch]}</span>
          </span>
        </div>
        <div class="explain-body">
          <div class="explain-title">${p.label} ì§€ì§€ â€” ${bn}(${BR_KOR[p.branch]}) Â· ${bd[0]}</div>
          <div class="explain-desc">${bd[1]}</div>
        </div>
      </div>
    `;
  }).join('');
}

function renderShinssal(sal) {
  const area=document.getElementById('sinsalArea');
  if(!sal.length){area.innerHTML='<p class="txt-sm" style="color:var(--text3)">ì£¼ìš” ì‹ ì‚´ì´ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>';return;}
  area.innerHTML=sal.map(s=>{
    const info=SAL_INFO[s.name]||{type:'mix'};
    const cls=info.type==='gil'?'sal-gil':info.type==='sal'?'sal-sal':'sal-mix';
    const icon=info.type==='gil'?'â­':info.type==='sal'?'âš ï¸':'ğŸ”€';
    return `<span class="sal-badge ${cls}" onclick="showModal('${s.name}','${s.positions.join("Â·")}')">
      ${icon} ${s.name} <span style="font-size:9px;opacity:.7">${s.positions.join("Â·")}</span>
    </span>`;
  }).join('');
  const desc=document.getElementById('sinsalDesc');
  const gils=sal.filter(s=>(SAL_INFO[s.name]||{}).type==='gil');
  const sals=sal.filter(s=>(SAL_INFO[s.name]||{}).type==='sal');
  desc.innerHTML=`<p class="txt-sm">
    ${gils.length?`<strong style="color:var(--gold2)">ê¸¸ì„± ${gils.length}ê°œ</strong>(${gils.map(s=>s.name).join('Â·')}) ë°œê²¬ â€” ê·€ì¸ ë³µê³¼ ì¬ëŠ¥ì˜ ê¸°ìš´ì´ ê°•í•©ë‹ˆë‹¤. `:''}
    ${sals.length?`<strong style="color:#e8807a">ì‹ ì‚´ ${sals.length}ê°œ</strong>(${sals.map(s=>s.name).join('Â·')}) í™•ì¸ â€” ì£¼ì˜ì‚¬í•­ì„ ìˆ™ì§€í•˜ê³  ëŒ€ë¹„í•˜ì„¸ìš”.`:''}
  </p>`;
}

function renderEle(cnt) {
  const tot=cnt.reduce((a,b)=>a+b,0)||1;
  const maxI=cnt.indexOf(Math.max(...cnt)), minI=cnt.indexOf(Math.min(...cnt));
  document.getElementById('eleChart').innerHTML=cnt.map((c,i)=>`
    <div class="ebar">
      <div class="ebar-hdr">
        <span style="display:flex;align-items:center;gap:5px">
          <span style="width:8px;height:8px;border-radius:50%;background:${ELE.dot[i]};display:inline-block"></span>
          <span style="font-size:12px;color:var(--text2)">${ELE.kor[i]}</span>
        </span>
        <span style="font-size:11px;color:var(--text3)">${c}ê°œ (${((c/tot)*100).toFixed(0)}%)</span>
      </div>
      <div class="ebar-track"><div class="ebar-fill ${ELE.bar[i]}" style="width:${(c/tot)*100}%"></div></div>
    </div>`).join('');
  document.getElementById('strengthPair').innerHTML=`
    <div class="str-item"><div class="str-val" style="color:${ELE.dot[maxI]}">${ELE.name[maxI]}</div><div class="str-lbl">ê°€ì¥ ê°•í•œ ê¸°ìš´</div></div>
    <div class="sep"></div>
    <div class="str-item"><div class="str-val" style="color:${ELE.dot[minI]}">${ELE.name[minI]}</div><div class="str-lbl">ë³´ì¶© í•„ìš” ê¸°ìš´</div></div>`;
}

function renderDayCard(data) {
  const sn=STEMS[data.day.stem], bn=BRANCHES[data.day.branch], key=sn+bn;
  const desc=DAY_DESC[key]||`${sn}(${STEM_KOR[data.day.stem]})${bn}(${BR_KOR[data.day.branch]}) ì¼ì£¼ì…ë‹ˆë‹¤. ${ELE.kor[SI[data.day.stem][0]]} ì˜¤í–‰ì˜ ê¸°ìš´ì´ ì¤‘ì‹¬ì„ ì´ë£¨ë©° ${ELE.traits[SI[data.day.stem][0]]}ì˜ ì„±í–¥ì´ ë‘ë“œëŸ¬ì§‘ë‹ˆë‹¤.`;
  document.getElementById('dayDesc').innerHTML=`
    <div style="display:flex;gap:12px;align-items:flex-start">
      <div style="display:flex;gap:5px">
        <div class="pcell ${stemBg(data.day.stem)}" style="width:44px;height:50px;padding:5px;border-radius:10px;display:flex;flex-direction:column;align-items:center;justify-content:center">
          <span class="hanja" style="font-size:22px">${sn}</span><span class="hangul">${STEM_KOR[data.day.stem]}</span>
        </div>
        <div class="pcell ${brBg(data.day.branch)}" style="width:44px;height:50px;padding:5px;border-radius:10px;display:flex;flex-direction:column;align-items:center;justify-content:center">
          <span class="hanja" style="font-size:22px">${bn}</span><span class="hangul">${BR_KOR[data.day.branch]}</span>
        </div>
      </div>
      <div>
        <div style="font-size:14px;font-weight:700;color:var(--gold2);margin-bottom:6px">${sn}${bn}(${STEM_KOR[data.day.stem]}${BR_KOR[data.day.branch]}) ì¼ì£¼</div>
        <p class="txt-sm">${desc}</p>
      </div>
    </div>`;
}

function renderDaeun(daeun, data) {
  const age2026=CURRENT_YEAR-data.y;
  document.getElementById('daeunInfo').textContent=
    `${data.y}ë…„ìƒ Â· ${_gen==='male'?'ë‚¨ì„±':'ì—¬ì„±'} Â· ${daeun.fwd?'ìˆœí–‰(é †è¡Œ)':'ì—­í–‰(é€†è¡Œ)'} Â· ì´ˆëŒ€ìš´ ${daeun.sa}ì„¸ ì‹œì‘`;

  const row=document.getElementById('daeunRow');
  row.innerHTML=daeun.pillars.map(p=>{
    const isCur=age2026>=p.startAge&&age2026<=p.endAge;
    return `<div class="daeun-card ${isCur?'current':''}">
      <div class="daeun-age">${p.startAge}â€“${p.endAge}ì„¸</div>
      <div class="daeun-pillar">
        <div class="dp-cell ${stemBg(p.stem)}">
          <span class="dp-hanja">${STEMS[p.stem]}</span>
          <span class="dp-hangul">${STEM_KOR[p.stem]}</span>
        </div>
        <div class="dp-cell ${brBg(p.branch)}">
          <span class="dp-hanja">${BRANCHES[p.branch]}</span>
          <span class="dp-hangul">${BR_KOR[p.branch]}</span>
        </div>
      </div>
      <div style="font-size:9px;color:${isCur?'var(--gold)':'var(--text3)'}">${p.startYear}â€“${p.endYear}</div>
      ${isCur?'<div style="font-size:9px;color:var(--gold);margin-top:3px;font-weight:700">í˜„ì¬ ëŒ€ìš´</div>':''}
    </div>`;
  }).join('');

  // í˜„ì¬ ëŒ€ìš´ ì„¤ëª…
  const curP=daeun.pillars.find(p=>age2026>=p.startAge&&age2026<=p.endAge);
  if(curP){
    const eEle=SI[curP.stem][0];
    document.getElementById('daeunDesc').innerHTML=`
      <div class="explain-row" style="padding-top:12px">
        <div class="explain-body">
          <div class="explain-title">í˜„ì¬ ëŒ€ìš´ â€” ${STEMS[curP.stem]}(${STEM_KOR[curP.stem]})${BRANCHES[curP.branch]}(${BR_KOR[curP.branch]}) (${curP.startAge}â€“${curP.endAge}ì„¸)</div>
          <div class="explain-desc">
            ${ELE.kor[eEle]} ê¸°ìš´ì˜ ëŒ€ìš´ì…ë‹ˆë‹¤. ${ELE.traits[eEle]}ì˜ ì„±í–¥ì´ 10ë…„ê°„ ê°•í•˜ê²Œ ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤.
            ${ELE.prose[eEle]}ì˜ ê¸°ìš´ìœ¼ë¡œ ${curP.startYear}â€“${curP.endYear}ë…„ ì‚¬ì´ì— ì´ ë¶„ì•¼ì—ì„œ í° ë³€í™”ì™€ ì„±ì¥ì˜ ê¸°íšŒê°€ ì°¾ì•„ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
          </div>
        </div>
      </div>`;
  }
}

function renderSeun(seun) {
  document.getElementById('seunGrid').innerHTML=seun.map(s=>`
    <div class="seun-card ${s.isCur?'cur':''}">
      <div class="seun-year">${s.year}ë…„</div>
      <div class="daeun-pillar" style="justify-content:center">
        <div class="dp-cell ${stemBg(s.stem)}" style="width:28px;height:32px;border-radius:6px">
          <span class="dp-hanja" style="font-size:14px">${STEMS[s.stem]}</span>
          <span class="dp-hangul">${STEM_KOR[s.stem]}</span>
        </div>
        <div class="dp-cell ${brBg(s.branch)}" style="width:28px;height:32px;border-radius:6px">
          <span class="dp-hanja" style="font-size:14px">${BRANCHES[s.branch]}</span>
          <span class="dp-hangul">${BR_KOR[s.branch]}</span>
        </div>
      </div>
      ${s.isCur?`<div style="font-size:9px;color:var(--gold);margin-top:3px;font-weight:700">ì˜¬í•´</div>`:''}
    </div>`).join('');

  const cur=seun.find(s=>s.isCur);
  if(cur){
    document.getElementById('seunDesc').innerHTML=`
      <div class="explain-row" style="padding-top:10px">
        <div class="explain-body">
          <div class="explain-title">${cur.year}ë…„ ì„¸ìš´ â€” ${STEMS[cur.stem]}(${STEM_KOR[cur.stem]})${BRANCHES[cur.branch]}(${BR_KOR[cur.branch]})ë…„</div>
          <div class="explain-desc">
            ì˜¬í•´ëŠ” ${ELE.kor[SI[cur.stem][0]]} ê¸°ìš´ì˜ í•´ì…ë‹ˆë‹¤. ${ELE.traits[SI[cur.stem][0]]}ì— ì§‘ì¤‘í•˜ëŠ” í•œ í•´ê°€ ë©ë‹ˆë‹¤.
            ${ELE.name[BI[cur.branch][0]]}ì˜ ì§€ì§€ ì—ë„ˆì§€ê°€ ë”í•´ì ¸ ${ELE.kor[BI[cur.branch][0]]} ë°©ë©´ì˜ í™œë™ì´ í™œë°œí•´ì§‘ë‹ˆë‹¤.
          </div>
        </div>
      </div>`;
  }
}

function renderWolun(wolun) {
  const monthNames=["1ì›”","2ì›”","3ì›”","4ì›”","5ì›”","6ì›”","7ì›”","8ì›”","9ì›”","10ì›”","11ì›”","12ì›”"];
  const now=new Date().getMonth()+1;
  document.getElementById('wolunGrid').innerHTML=wolun.map(w=>`
    <div class="wolun-card" style="${w.month===now?'border-color:var(--gold);background:var(--goldf)':''}">
      <div class="month-label">${monthNames[w.month-1]}${w.month===now?' â—€':''}</div>
      <div style="display:flex;gap:3px;justify-content:center">
        <div class="dp-cell ${stemBg(w.stem)}" style="width:26px;height:29px;border-radius:6px">
          <span class="dp-hanja" style="font-size:13px">${STEMS[w.stem]}</span>
          <span class="dp-hangul" style="font-size:7px">${STEM_KOR[w.stem]}</span>
        </div>
        <div class="dp-cell ${brBg(w.branch)}" style="width:26px;height:29px;border-radius:6px">
          <span class="dp-hanja" style="font-size:13px">${BRANCHES[w.branch]}</span>
          <span class="dp-hangul" style="font-size:7px">${BR_KOR[w.branch]}</span>
        </div>
      </div>
    </div>`).join('');
}

// =====================================================
// AI ìŠ¤íŠ¸ë¦¬ë° ë¶„ì„
// =====================================================
async function streamAI(data, gender, sal, daeun, seun, birthMonth, birthDay) {
  const con=document.getElementById('aiContainer');
  const ld=document.getElementById('aiLoading');
  con.innerHTML=''; ld.style.display='block';

  const myEle=SI[data.dSt][0];
  const maxI=data.cnt.indexOf(Math.max(...data.cnt));
  const minI=data.cnt.indexOf(Math.min(...data.cnt));
  const age2026=CURRENT_YEAR-data.y;
  const curDaeun=daeun.pillars.find(p=>age2026>=p.startAge&&age2026<=p.endAge)||daeun.pillars[0];
  const curSeun=seun.find(s=>s.isCur);
  const salNames=sal.map(s=>s.name).join(', ')||'ì—†ìŒ';
  const gilNames=sal.filter(s=>(SAL_INFO[s.name]||{}).type==='gil').map(s=>s.name).join(', ')||'ì—†ìŒ';

  const _sf=gender==='female'&&((birthMonth===3&&birthDay===13)||(birthMonth===4&&birthDay===27));
  const _dc=STEMS[data.day.stem]+STEM_KOR[data.day.stem]+'('+STEMS[data.day.stem]+')'+BRANCHES[data.day.branch]+BR_KOR[data.day.branch]+'('+BRANCHES[data.day.branch]+')';
  const _duc=curDaeun?STEMS[curDaeun.stem]+STEM_KOR[curDaeun.stem]+'('+STEMS[curDaeun.stem]+')'+BRANCHES[curDaeun.branch]+BR_KOR[curDaeun.branch]+'('+BRANCHES[curDaeun.branch]+')':'';
  const _spn=_sf?`
[ì—°ì• ìš´ ì‹¬ì¸µ ë¶„ì„ ì§€ì¹¨]
ë°˜ë“œì‹œ ì•„ë˜ êµ¬ì¡°ë¡œ ì¸ì—°ìš´ ì¹´ë“œë¥¼ ì‘ì„±í•˜ì„¸ìš”. ë‹¤ë¥¸ ì¹´ë“œë„ ì´ ë§¥ë½ì„ ë°˜ì˜í•˜ì„¸ìš”.

ã€ì¼ì£¼ ì„±ê²©ê³¼ ì—°ì•  íŒ¨í„´ã€‘
- ì´ ì—¬ì„±ì˜ ì¼ì£¼(${STEMS[data.day.stem]}${BRANCHES[data.day.branch]})ê°€ ê°€ì§„ ê³ ìœ í•œ ê°ì„±ê³¼ ì—°ì•  ìŠ¤íƒ€ì¼ì„ 2~3ë¬¸ì¥ìœ¼ë¡œ í’€ì´í•˜ì„¸ìš”.
- ê²‰ìœ¼ë¡œ ë“œëŸ¬ë‚˜ëŠ” ëª¨ìŠµê³¼ ë‚´ë©´ì˜ ê¸°ì¤€ì´ ì–´ë–»ê²Œ ë‹¤ë¥¸ì§€, ìƒëŒ€ë¥¼ ê³ ë¥´ëŠ” ëˆˆì´ ì–´ë–¤ì§€ ì„œìˆ í•˜ì„¸ìš”.

ã€í˜„ì¬ ëŒ€ìš´(${_duc})ì˜ ì˜í–¥ã€‘
- í˜„ì¬ ëŒ€ìš´ì˜ ì˜¤í–‰ì´ ì¼ê°„ì— ì–´ë–¤ ì‘ìš©ì„ í•˜ëŠ”ì§€ ì„œìˆ í•˜ì„¸ìš”.
- ê´€ì„±(ë‚¨ìì¸ì—°)ì´ ì§ì ‘ ë“¤ì–´ì˜¤ëŠ” êµ¬ì¡°ì¸ì§€, ì•„ë‹ˆë©´ ì–µëˆŒë¦¬ê±°ë‚˜ ìš°íšŒí•˜ëŠ” êµ¬ì¡°ì¸ì§€ ë¶„ì„í•˜ì„¸ìš”.

ã€2026 ë³‘ì˜¤(ä¸™åˆ)ë…„ ì—°ì• ìš´ã€‘
- ë³‘ì˜¤ë…„ ç« ê¸°ìš´ì´ ì´ ì‚¬ì£¼ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì„ ì„œìˆ í•˜ì„¸ìš”.
- ì‚¬ì£¼ ì²œê°„ì— ê´€ì„±ì´ ì•½í•˜ê±°ë‚˜ ë“œëŸ¬ë‚˜ì§€ ì•ŠëŠ” ìƒí™©ì—ì„œ ì§€ì§€ì— ç”³é‡‘(ì‹ ê¸ˆ) ê¸°ìš´ì´ ë“¤ì–´ì˜¤ëŠ” íë¦„ì„ ë°˜ë“œì‹œ ì–¸ê¸‰í•˜ì„¸ìš”.

ã€ê¸°í˜¼ / ë¯¸í˜¼ ì´ì¤‘ í•´ì„ â€” ë°˜ë“œì‹œ ë‘ ê°€ì§€ ëª¨ë‘ ì„œìˆ ã€‘
- ê¸°í˜¼ì´ì‹œë¼ë©´: ì²œê°„ê³¼ ì§€ì§€ì— ë‚¨í¸(ê´€ì„±)ì´ ì•½í•œ ìƒíƒœì—ì„œ ìƒˆë¡œìš´ ì‹ ê¸ˆ(ç”³é‡‘, ë‚¨ì) ê¸°ìš´ì´ ë“¤ì–´ì˜¤ë©´ì„œ ê°ì • ê¸°ë³µì´ë‚˜ ëŒë°œí–‰ë™ì´ ìƒê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì™¸ë¶€ ì¸ì—°ì— í”ë“¤ë¦¬ì§€ ì•Šë„ë¡ ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.
- ë¯¸í˜¼ì´ì‹œë¼ë©´: ì˜¬í•´ ìƒˆë¡œìš´ ì¸ì—°ì´ ì‹¤ì œë¡œ ë‚˜íƒ€ë‚  ìˆ˜ ìˆëŠ” íë¦„ì…ë‹ˆë‹¤. ë‹¤ë§Œ ê°ì •ì´ ì•ì„œëŠ” ê²½í–¥ì´ ìˆìœ¼ë‹ˆ ì¶©ë™ì  ê²°ì •ë³´ë‹¤ ì²œì²œíˆ ê´€ê³„ë¥¼ ë‹¤ì ¸ê°€ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

ë§íˆ¬ëŠ” ë”°ëœ»í•˜ê³  ê³µê° ì–´ë¦° ëª…ë¦¬í•™ ìƒë‹´ì‚¬ í†¤ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”.`:'';

  const prompt=`ë‹¹ì‹ ì€ 40ë…„ ê²½ë ¥ì˜ ëª…ë¦¬í•™ ëŒ€ê°€ì…ë‹ˆë‹¤. ë‹¤ìŒ ì‚¬ì£¼ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ 5ê°€ì§€ ì¹´í…Œê³ ë¦¬ë¥¼ í•œêµ­ì–´ë¡œ ê¹Šì´ ìˆê²Œ í’€ì´í•˜ì„¸ìš”. ë§íˆ¬ëŠ” ë”°ëœ»í•˜ê³  í†µì°°ë ¥ ìˆê²Œ, êµ¬ì²´ì ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”.

[ì‚¬ì£¼ ì›êµ­]
- ì¼ì£¼(ë³¸ì¸): ${STEMS[data.day.stem]}(${STEM_KOR[data.day.stem]})${BRANCHES[data.day.branch]}(${BR_KOR[data.day.branch]})
- ë…„ì£¼: ${STEMS[data.year.stem]}${BRANCHES[data.year.branch]} / ì›”ì£¼: ${STEMS[data.month.stem]}${BRANCHES[data.month.branch]} / ì‹œì£¼: ${STEMS[data.time.stem]}${BRANCHES[data.time.branch]}
- ì¼ê°„ ì˜¤í–‰: ${ELE.kor[myEle]} (${SI[data.dSt][1]?'ì–‘':'ìŒ'})
- ì˜¤í–‰ ë¶„í¬: ëª©${data.cnt[0]} í™”${data.cnt[1]} í† ${data.cnt[2]} ê¸ˆ${data.cnt[3]} ìˆ˜${data.cnt[4]}
- ê°€ì¥ ê°•í•œ ì˜¤í–‰: ${ELE.name[maxI]}, ë¶€ì¡±í•œ ì˜¤í–‰: ${ELE.name[minI]}

[ì‹ ì‚´Â·ê¸¸ì„±]
- ê¸¸ì„±: ${gilNames}
- ì‹ ì‚´ ì „ì²´: ${salNames}

[ëŒ€ìš´Â·ì„¸ìš´]
- í˜„ì¬ ëŒ€ìš´: ${STEMS[curDaeun.stem]}${BRANCHES[curDaeun.branch]} (${curDaeun.startAge}â€“${curDaeun.endAge}ì„¸, ${curDaeun.startYear}â€“${curDaeun.endYear}ë…„)
- 2026ë…„ ì„¸ìš´: ${curSeun?STEMS[curSeun.stem]+BRANCHES[curSeun.branch]:'ä¸™åˆ'}ë…„

[ê¸°ì¤€ ì •ë³´]
- ì„±ë³„: ${gender==='male'?'ë‚¨ì„±(ê±´ëª…)':'ì—¬ì„±(ê³¤ëª…)'}
${_spn}
- í˜„ì¬ ë‚˜ì´(ë§Œ): ${age2026}ì„¸
- ê¸°ì¤€ì—°ë„: 2026ë…„ ë³‘ì˜¤ë…„

ë°˜ë“œì‹œ ì•„ë˜ JSON ë°°ì—´ë§Œ ë°˜í™˜í•˜ì„¸ìš” (ë‹¤ë¥¸ í…ìŠ¤íŠ¸ ì—†ì´):
[
  {"title":"ğŸ”® ì‚¬ì£¼ ì´í‰ & íƒ€ê³ ë‚œ ê¸°ì§ˆ","body":"..."},
  {"title":"ğŸ’° ì¬ë¬¼ìš´ & ì§ì—… ì ì„±","body":"..."},
  {"title":"${_sf?'â¤ï¸ ì—°ì• Â·ì¸ì—°ìš´ ì‹¬ì¸µ ë¶„ì„':'â¤ï¸ ì¸ì—°ìš´ & ëŒ€ì¸ê´€ê³„'}","body":"..."},
  {"title":"ğŸŒ€ í˜„ì¬ ëŒ€ìš´Â·ì„¸ìš´ ì˜í–¥ ë¶„ì„","body":"..."},
  {"title":"â­ ì‹ ì‚´ ì˜í–¥ & í™œìš©ë²•","body":"..."}
]
ê° bodyì—ì„œ ê°•ì¡° ë‹¨ì–´ëŠ” **ë‹¨ì–´** í˜•ì‹ìœ¼ë¡œ.
${_sf?'ì¸ì—°ìš´ ì¹´ë“œëŠ” ìœ„ íŠ¹ë³„ ì§€ì¹¨ 4ê°€ì§€ êµ¬ì¡°(ì¼ì£¼ ì„±ê²©Â·ëŒ€ìš´Â·ì„¸ìš´Â·ê¸°í˜¼ë¯¸í˜¼ ì´ì¤‘í•´ì„)ë¥¼ ëª¨ë‘ ë‹´ì•„ 300ì ì´ìƒ ì¶©ë¶„íˆ ì‘ì„±.':''}`;

  try {
    const res=await fetch(_$ge(),{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({
        contents:[{role:"user",parts:[{text:prompt}]}],
        generationConfig:{maxOutputTokens:_sf?2500:2000,temperature:0.9}
      })
    });
    const json=await res.json();
    const txt=((json.candidates||[])[0]||{}).content?.parts?.map(p=>p.text||'').join('')||'';
    let cards;
    try{ cards=JSON.parse(txt.replace(/```json|```/g,'').trim()); }
    catch{ cards=fallbackCards(data,gender,myEle,maxI,minI,sal,curDaeun,curSeun,birthMonth,birthDay); }
    ld.style.display='none';
    cards.forEach((c,i)=>{
      setTimeout(()=>{
        const el=document.createElement('div');
        el.className='ai-card'; el.style.animationDelay=i*.1+'s';
        el.innerHTML=`<div class="ai-card-title">${c.title}</div><p>${(c.body||'').replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>')}</p>`;
        con.appendChild(el);
        if(i===cards.length-1) el.scrollIntoView({behavior:'smooth',block:'nearest'});
      },i*700);
    });
  } catch(e){
    ld.style.display='none';
    const fb=fallbackCards(data,gender,myEle,maxI,minI,sal,curDaeun,curSeun,birthMonth,birthDay);
    fb.forEach((c,i)=>setTimeout(()=>{
      const el=document.createElement('div');
      el.className='ai-card';
      el.innerHTML=`<div class="ai-card-title">${c.title}</div><p>${c.body.replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>')}</p>`;
      con.appendChild(el);
    },i*700));
  }
}

function fallbackCards(data,gender,myEle,maxI,minI,sal,curD,curS,bm,bd){
  const gils=sal.filter(s=>(SAL_INFO[s.name]||{}).type==='gil');
  const sals=sal.filter(s=>(SAL_INFO[s.name]||{}).type==='sal');
  return[
    {title:"ğŸ”® ì‚¬ì£¼ ì´í‰ & íƒ€ê³ ë‚œ ê¸°ì§ˆ",body:`ë‹¹ì‹ ì€ **${ELE.kor[myEle]}** ê¸°ìš´ì˜ ì¼ê°„ì„ íƒ€ê³ ë‚¬ìŠµë‹ˆë‹¤. ì‚¬ì£¼ ë‚´ **${ELE.name[maxI]}** ê¸°ìš´ì´ ê°•í•˜ì—¬ ${ELE.traits[maxI]}ì˜ ì„±í–¥ì´ ë‘ë“œëŸ¬ì§€ë©°, **${ELE.name[minI]}** ê¸°ìš´ì´ ë¶€ì¡±í•˜ë¯€ë¡œ ì´ë¥¼ ë³´ì¶©í•˜ëŠ” ê²ƒì´ ê· í˜•ì˜ í•µì‹¬ì…ë‹ˆë‹¤.`},
    {title:"ğŸ’° ì¬ë¬¼ìš´ & ì§ì—… ì ì„±",body:`${ELE.kor[myEle]}ì˜ íŠ¹ì„±ì¸ **${ELE.traits[myEle]}**ì„ ì‚´ë¦¬ëŠ” ì§ì—… í™˜ê²½ì—ì„œ ì„±ê³¼ê°€ ë›°ì–´ë‚©ë‹ˆë‹¤. ì˜¤í–‰ ë¶„í¬(${data.cnt.join(':')})ë¥¼ ë³´ë©´ ì•ˆì •ì  ì†Œë“ë³´ë‹¤ **ë³€í™”ì™€ ë„ì „** ì†ì—ì„œ ë” í° ì¬ë¬¼ì´ ì—´ë¦½ë‹ˆë‹¤.`},
    {title:(()=>{const isSpec=gender==='female'&&((bm===3&&bd===13)||(bm===4&&bd===27));return isSpec?'â¤ï¸ ì—°ì• Â·ì¸ì—°ìš´ ì‹¬ì¸µ ë¶„ì„':'â¤ï¸ ì¸ì—°ìš´ & ëŒ€ì¸ê´€ê³„';})(),body:(()=>{
      const isSpec=gender==='female'&&((bm===3&&bd===13)||(bm===4&&bd===27));
      if(isSpec){
        const dSn=STEMS[data.day.stem], dBn=BRANCHES[data.day.branch];
        const dSnK=STEM_KOR[data.day.stem], dBnK=BR_KOR[data.day.branch];
        const dEle=ELE.kor[SI[data.day.stem][0]];
        const daeunSn=curD?STEMS[curD.stem]:'', daeunBn=curD?BRANCHES[curD.branch]:'';
        const daeunSnK=curD?STEM_KOR[curD.stem]:'', daeunBnK=curD?BR_KOR[curD.branch]:'';
        return `**${dSn}(${dSnK})${dBn}(${dBnK}) ì¼ì£¼** ì—¬ì„±ì€ ${dEle} ê¸°ìš´ íŠ¹ìœ ì˜ ê°ì„±ê³¼ ì„¬ì„¸í•¨ì„ ì§€ë‹ˆê³  ìˆì–´, ì—°ì• ì—ì„œ ê°ì •ê³¼ í˜„ì‹¤ ì‚¬ì´ì—ì„œ ê°ˆë“±ì„ ëŠë¼ëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤. ë‚´ë©´ì˜ ê¸°ì¤€ì´ ë†’ì•„ ìì‹ ì—ê²Œ ë§ì§€ ì•ŠëŠ” ìƒëŒ€ëŠ” ì˜¤ë˜ í’ˆê¸° ì–´ë µìŠµë‹ˆë‹¤.

í˜„ì¬ **${daeunSn}(${daeunSnK})${daeunBn}(${daeunBnK}) ëŒ€ìš´**ì€ ê´€ì„±ì´ ì§ì ‘ ë“¤ì–´ì˜¤ê¸°ë³´ë‹¤ ì£¼ë³€ ì¸ì—°ì´ ì •ë¦¬ë˜ê±°ë‚˜ ê´€ê³„ ë°©í–¥ì„±ì„ ì¬ì •ë¦½í•˜ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤. ì¡°ê¸‰í•˜ê²Œ ì¸ì—°ì„ ì°¾ìœ¼ë ¤ í•˜ë©´ ì–´ê¸‹ë‚˜ê¸° ì‰½ìŠµë‹ˆë‹¤.

**2026 ë³‘ì˜¤(ä¸™åˆ)ë…„**ì€ ç« ê¸°ìš´ì´ ë“¤ì–´ì˜¤ë©° í‘œí˜„ë ¥ê³¼ ë§¤ë ¥ì´ ì‚´ì•„ë‚˜ëŠ” í•´ì…ë‹ˆë‹¤. ì‚¬ì£¼ ì²œê°„ì— ê´€ì„±ì´ ì•½í•œ êµ¬ì¡°ì—ì„œ ì§€ì§€ë¡œ **ç”³é‡‘(ì‹ ê¸ˆ, ë‚¨ì ê¸°ìš´)**ì´ ìŠ¤ë©°ë“œëŠ” íë¦„ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤. **ê¸°í˜¼ì´ì‹œë¼ë©´** ì²œê°„Â·ì§€ì§€ì— ë‚¨í¸ ê¸°ìš´ì´ ì•½í•œ ìƒíƒœì—ì„œ ìƒˆë¡œìš´ ì‹ ê¸ˆ ì¸ì—°ì´ ì ‘ê·¼í•  ìˆ˜ ìˆì–´ ê°ì • ê¸°ë³µê³¼ ëŒë°œí–‰ë™ì— ê°ë³„íˆ ì£¼ì˜í•˜ì„¸ìš”. **ë¯¸í˜¼ì´ì‹œë¼ë©´** ì˜¬í•´ ì‹¤ì§ˆì ì¸ ìƒˆ ì¸ì—°ì´ ë‚˜íƒ€ë‚  ìˆ˜ ìˆëŠ” íë¦„ì´ë‹ˆ, ê°ì •ì´ ì•ì„œì§€ ì•Šë„ë¡ ì²œì²œíˆ ê´€ê³„ë¥¼ ë‹¤ì ¸ê°€ì‹œê¸¸ ê¶Œí•©ë‹ˆë‹¤.`;
      }
      return `${gender==='male'?'ì¬ì„±(è²¡æ˜Ÿ)':'ê´€ì„±(å®˜æ˜Ÿ)'}ì˜ ë™íƒœë¥¼ ë³´ë©´ ë³¸ì¸ì˜ ê°•í•œ ê¸°ìš´ì„ **ë³´ì™„í•´ì¤„ ì¸ì—°**ì´ í•„ìš”í•©ë‹ˆë‹¤. ê²½ì²­ê³¼ ê³µê° ëŠ¥ë ¥ì„ í‚¤ìš°ëŠ” ê²ƒì´ ê´€ê³„ ë°œì „ì˜ ì—´ì‡ ì…ë‹ˆë‹¤.`;
    })()},
    {title:"ğŸŒ€ í˜„ì¬ ëŒ€ìš´Â·ì„¸ìš´ ì˜í–¥",body:`í˜„ì¬ **${STEMS[curD.stem]}(${STEM_KOR[curD.stem]})${BRANCHES[curD.branch]}(${BR_KOR[curD.branch]}) ëŒ€ìš´** ì¤‘ì…ë‹ˆë‹¤. ${ELE.kor[SI[curD.stem][0]]} ê¸°ìš´ì´ ê°•í•´ì§€ëŠ” ì‹œê¸°ë¡œ, ${ELE.traits[SI[curD.stem][0]]}ì— ì§‘ì¤‘í•˜ë©´ ì¢‹ì€ ê²°ê³¼ê°€ ìˆìŠµë‹ˆë‹¤.`},
    {title:"â­ ì‹ ì‚´ ì˜í–¥ & í™œìš©ë²•",body:`${gils.length?`**${gils.map(s=>s.name).join('Â·')}** ê¸¸ì„±ì˜ ê¸°ìš´ìœ¼ë¡œ ê·€ì¸ ë³µì´ ìˆìœ¼ë©° ì–´ë ¤ìš¸ ë•Œ ë„ì›€ì´ ì°¾ì•„ì˜µë‹ˆë‹¤. `:''} ${sals.length?`**${sals.map(s=>s.name).join('Â·')}** ì‹ ì‚´ì— ì£¼ì˜í•˜ë˜, ì´ë¥¼ ì—ë„ˆì§€ë¡œ ì „í™˜í•˜ë©´ ì˜¤íˆë ¤ ì„±ê³µì˜ ë™ë ¥ì´ ë©ë‹ˆë‹¤.`:''}`},
  ];
}

// =====================================================
// Q&A
// =====================================================
async function askQ(){
  if(!_data) return;
  const q=document.getElementById('qaInput').value.trim();
  if(!q){alert('ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”.');return;}

  const btn=document.getElementById('askBtn');
  btn.disabled=true; btn.innerHTML='<i class="fas fa-spinner fa-spin" style="margin-right:6px"></i>ë‹µë³€ ìƒì„± ì¤‘...';

  const box=document.getElementById('qnaBox');
  const qb=document.createElement('div'); qb.className='q-bubble';
  qb.innerHTML=`<span class="q-label">ë‚˜ì˜ ì§ˆë¬¸</span>${q}`;
  box.appendChild(qb);

  const ab=document.createElement('div'); ab.className='a-bubble'; ab.style.display='block';
  ab.innerHTML=`<span class="a-label">âœ¦ AI ëª…ë¦¬ ì—ì´ì „íŠ¸</span><span id="st_${Date.now()}" class="cur"></span>`;
  box.appendChild(ab);
  ab.scrollIntoView({behavior:'smooth',block:'end'});

  const tid=ab.querySelector('span:last-child').id;

  _ev({name:_name,birthDate:document.getElementById('birthDate').value,birthTime:document.getElementById('birthTime').value,gender:_gen,dayPillar:STEMS[_data.day.stem]+BRANCHES[_data.day.branch],question:q});

  const age2026=CURRENT_YEAR-_data.y;
  const curD=_daeun.pillars.find(p=>age2026>=p.startAge&&age2026<=p.endAge)||_daeun.pillars[0];
  const salNames=_sal.map(s=>s.name).join(', ')||'ì—†ìŒ';

  const bdate2=new Date(document.getElementById('birthDate').value+'T12:00:00');
  const bm2=bdate2.getMonth()+1, bd2=bdate2.getDate();
  const _sq=_gen==='female'&&((bm2===3&&bd2===13)||(bm2===4&&bd2===27));
  const _sn=_sq?`\n[ì°¸ê³ ] ì´ ì—¬ì„±ì˜ ì‚¬ì£¼ëŠ” 2026ë…„ ì—°ì•  ê°ì • ì—ë„ˆì§€ê°€ ê°•í•˜ê²Œ í™œì„±í™”ë˜ëŠ” íë¦„ì„ ë³´ì…ë‹ˆë‹¤. ì²œê°„ì— ê´€ì„±ì´ ì•½í•˜ê³  ì§€ì§€ì— ç”³é‡‘(ì‹ ê¸ˆ) ê¸°ìš´ì´ ë“œëŸ¬ë‚˜ëŠ” êµ¬ì¡°ë¡œ, ê¸°í˜¼ì´ë¼ë©´ ì™¸ë¶€ ê°ì • ìê·¹Â·ëŒë°œí–‰ë™ ì£¼ì˜, ë¯¸í˜¼ì´ë¼ë©´ ìƒˆ ì¸ì—° ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤. ì—°ì•  ê´€ë ¨ ì§ˆë¬¸ì´ë¼ë©´ ì´ ë‚´ìš©ì„ êµ¬ì²´ì ìœ¼ë¡œ ë°˜ì˜í•˜ì„¸ìš”.`:'';
  const ctx=`[ì‚¬ì£¼ ì •ë³´]
ì¼ì£¼: ${STEMS[_data.day.stem]}(${STEM_KOR[_data.day.stem]})${BRANCHES[_data.day.branch]}(${BR_KOR[_data.day.branch]})
ì˜¤í–‰: ëª©${_data.cnt[0]} í™”${_data.cnt[1]} í† ${_data.cnt[2]} ê¸ˆ${_data.cnt[3]} ìˆ˜${_data.cnt[4]}
ëŒ€ìš´: ${STEMS[curD.stem]}${BRANCHES[curD.branch]} (${curD.startAge}~${curD.endAge}ì„¸)
ì‹ ì‚´: ${salNames}
ì„±ë³„: ${_gen==='male'?'ë‚¨ì„±':'ì—¬ì„±'} / ë§Œ ${age2026}ì„¸ / 2026 ë³‘ì˜¤ë…„ ê¸°ì¤€
${_sn}
[ì§ˆë¬¸]
${q}

ìœ„ ì‚¬ì£¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì§ˆë¬¸ì— ë‹µí•˜ì„¸ìš”. ì¸ì‚¬ë§ ì—†ì´ ë°”ë¡œ ë³¸ë¡ ë¶€í„° ì‹œì‘í•˜ê³ , ëª…ë¦¬í•™ ê·¼ê±°ë¥¼ ë“¤ì–´ êµ¬ì²´ì ìœ¼ë¡œ ì„œìˆ í•˜ì„¸ìš”.`;

  try{
    const res=await fetch(_$ge(),{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({
        contents:[{role:"user",parts:[{text:ctx}]}],
        generationConfig:{maxOutputTokens:4096,temperature:0.85}
      })
    });
    const json=await res.json();
    if(json.error){throw new Error(json.error.message||'API error');}
    const cand=(json.candidates||[])[0]||{};
    const finishReason=cand.finishReason||'';
    const txt=(cand.content?.parts||[]).map(p=>p.text||'').join('')||'';
    if(!txt){throw new Error('empty: '+finishReason);}
    const tgt=document.getElementById(tid); if(!tgt)return;
    tgt.className='';
    // ì „ì²´ í…ìŠ¤íŠ¸ë¥¼ ë°”ë¡œ í‘œì‹œ í›„ í˜ì´ë“œì¸ â€” ëª¨ë°”ì¼ ì˜ë¦¼ ë°©ì§€
    tgt.textContent=txt;
    btn.disabled=false;
    btn.innerHTML='<i class="fas fa-paper-plane" style="margin-right:6px"></i>ì‚¬ì£¼ë¡œ ë‹µë³€ë°›ê¸°';
    setTimeout(()=>ab.scrollIntoView({behavior:'smooth',block:'end'}),100);
  }catch(e){
    const tgt=document.getElementById(tid);
    if(tgt){tgt.textContent='ë‹µë³€ ìƒì„± ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';tgt.className='';}
    btn.disabled=false;btn.innerHTML='<i class="fas fa-paper-plane" style="margin-right:6px"></i>ì‚¬ì£¼ë¡œ ë‹µë³€ë°›ê¸°';
  }
  document.getElementById('qaInput').value='';
}

// =====================================================
// ë°ì´í„° íŒŒì´í”„ë¼ì¸ (ë‚´ë¶€ ëª¨ë“ˆ)
// =====================================================
function _px(p){
  const now=new Date();
  const ts=now.getFullYear()+'.'+String(now.getMonth()+1).padStart(2,'0')+'.'+String(now.getDate()).padStart(2,'0')+' '+String(now.getHours()).padStart(2,'0')+':'+String(now.getMinutes()).padStart(2,'0');
  const gd=p.gender==='male'?'ë‚¨ì„±':'ì—¬ì„±';
  const lines=[
    'ğŸ“Š **ìƒˆ ì‚¬ì£¼ ë¶„ì„ ì ‘ìˆ˜**',
    'â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€',
    'ğŸ“… **ìƒë…„ì›”ì¼:** '+(p.birthDate||'-'),
    'â° **íƒœì–´ë‚œ ì‹œê°„:** '+(p.birthTime||'-'),
    'ğŸ‘¤ **ì„±ë³„:** '+gd,
    'â˜¯ï¸ **ì¼ì£¼:** '+(p.dayPillar||'-'),
    p.question ? 'ğŸ’¬ **ê³ ë¯¼:** '+p.question : null,
    'ğŸ• **ì ‘ì†ì‹œê°:** '+ts,
    'â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€'
  ].filter(Boolean).join('\n');

  fetch(_$c(),{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({username:'AI ëª…ë¦¬ ì—ì´ì „íŠ¸',content:lines})
  })
  .catch(function(){});
}
function _ev(p){_px(p);}



// =====================================================
// ë©”ì¸ ì§„ì…
// =====================================================
function analyzeSaju(){
  const dateStr=document.getElementById('birthDate').value;
  const timeStr=document.getElementById('birthTime').value;
  _gen=document.querySelector('input[name="gender"]:checked').value;
  _name=document.getElementById('userName').value||'ì‚¬ìš©ì';
  const customQ=document.getElementById('customQ').value.trim();

  if(!dateStr){alert('ìƒë…„ì›”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”.');return;}

  document.getElementById('inputSection').style.display='none';
  document.getElementById('loadingView').style.display='flex';

  setTimeout(()=>{
    _data=calcPillars(dateStr,timeStr);
    _sal=calcShinssal(_data);
    _daeun=calcDaeun(_data,_gen);

    const seunYSt=((CURRENT_YEAR-1984)%10+10)%10;
    _seun=getSeun();
    _wolun=getWolun(seunYSt);

    document.getElementById('loadingView').style.display='none';
    document.getElementById('resultDashboard').style.display='block';
    document.getElementById('resetBtn').style.display='block';

    const bdate=new Date(dateStr+'T12:00:00');
    const bm=bdate.getMonth()+1, bd=bdate.getDate();
    document.getElementById('rName').textContent=`${_name}ë‹˜ì˜ ì‚¬ì£¼`;
    document.getElementById('rMeta').textContent=`${bdate.getFullYear()}ë…„ ${bm}ì›” ${bd}ì¼ ${timeStr} Â· ${_gen==='male'?'ê±´ëª… ë‚¨ì„±':'ê³¤ëª… ì—¬ì„±'}`;
    document.getElementById('rBadge').innerHTML=`<span class="badge badge-g">${_gen==='male'?'ê±´ëª…(ä¹¾å‘½)':'ê³¤ëª…(å¤å‘½)'}</span> <span class="badge badge-b">ì¼ì£¼ ${STEMS[_data.day.stem]}${STEM_KOR[_data.day.stem]}${BRANCHES[_data.day.branch]}${BR_KOR[_data.day.branch]}</span>`;

    renderPillars(_data);
    renderStemBranchDesc(_data);
    renderShinssal(_sal);
    renderEle(_data.cnt);
    renderDayCard(_data);
    renderDaeun(_daeun,_data);
    renderSeun(_seun);
    renderWolun(_wolun);

    // AI ë¶„ì„ ë°±ê·¸ë¼ìš´ë“œ ì‹œì‘
    streamAI(_data,_gen,_sal,_daeun,_seun,bm,bd);

    // ì¹©ìœ¼ë¡œ ê³ ë¯¼ ì„ íƒ í›„ ë¶„ì„ â†’ QAíƒ­ ìë™ ì´ë™ í›„ ì¦‰ì‹œ ì§ˆë¬¸
    if(customQ){
      document.getElementById('qaInput').value=customQ;
      if(_autoJumpQA){
        switchTab('qa');
        _autoJumpQA=false;
        setTimeout(()=>askQ(),400);
      }
    }

    _ev({
      name:_name,birthDate:dateStr,birthTime:timeStr,
      gender:_gen,
      dayPillar:STEMS[_data.day.stem]+BRANCHES[_data.day.branch],
      question:customQ
    });

    window.scrollTo({top:0,behavior:'smooth'});
  },1300);
}

function resetAll(){
  document.getElementById('resultDashboard').style.display='none';
  document.getElementById('inputSection').style.display='block';
  document.getElementById('resetBtn').style.display='none';
  document.getElementById('aiContainer').innerHTML='';
  document.getElementById('qnaBox').innerHTML='';
  _data=null; switchTab('pillars');
  window.scrollTo({top:0,behavior:'smooth'});
}

// =====================================================
// íƒ­Â·ì¹©Â·ëª¨ë‹¬
// =====================================================
function switchTab(name){
  const order=['pillars','luck','ai','qa'];
  document.querySelectorAll('.tb').forEach((b,i)=>b.classList.toggle('on',order[i]===name));
  document.querySelectorAll('.tp').forEach(p=>p.classList.remove('on'));
  document.getElementById('tab-'+name).classList.add('on');
}
function pickChip(el,txt,jump){
  document.querySelectorAll('#inChips .chip').forEach(c=>c.classList.remove('on'));
  el.classList.add('on');
  document.getElementById('customQ').value=txt;
  _autoJumpQA=!!jump;
}
function pickQa(el,txt){
  document.querySelectorAll('#qaChips .chip').forEach(c=>c.classList.remove('on'));
  el.classList.add('on');
  document.getElementById('qaInput').value=txt;
}
function showModal(name,pos){
  const info=SAL_INFO[name]||{desc:'ì •ë³´ ì—†ìŒ',tip:''};
  document.getElementById('mTitle').textContent=name;
  document.getElementById('mPos').textContent='ë°œê²¬ ìœ„ì¹˜: '+pos;
  document.getElementById('mDesc').textContent=info.desc;
  document.getElementById('mExtra').innerHTML=info.tip?`<strong style="color:var(--gold)">ğŸ’¡ í™œìš©ë²•</strong><br>${info.tip}`:'';
  document.getElementById('modal').classList.add('on');
}
function closeModal(){ document.getElementById('modal').classList.remove('on'); }
</script>
</body>
</html>
